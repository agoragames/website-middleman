<!DOCTYPE html> <html class=no-js lang=en> <head> <meta charset=utf-8> <meta content='width=device-width, initial-scale=1.0' name=viewport> <meta content='IE=edge,chrome=1' http-equiv=X-UA-Compatible> <title>Brain Matters</title> <link href="/assets/stylesheets/app-0c494247.css" rel=stylesheet /> <script src="/assets/javascripts/modernizr-84a49412.js"></script> <link href='/assets/images/favicon.ico' rel='shortcut icon'> </head> <body class='blog blog_2010 blog_2010_11 blog_2010_11_17 blog_2010_11_17_index f-topbar-fixed'> <div class='fixed raised'> <nav class=top-bar data-topbar role=navigation> <ul class=title-area> <li class=name> <h1> <a href='/'> <img alt="Agora Games" class=main-logo src="/assets/images/agoragames-new-8534f601.svg"/> </a> </h1> </li> <li class='toggle-topbar menu-icon'> <a href='javascript:void(0)'> <span>Menu</span> </a> </li> </ul> <section class=top-bar-section> <ul class=right> <li> <a data-anchor href='/#about'>About</a> </li> <li> <a data-anchor href='/#team'>Team</a> </li> <li> <a data-anchor href='/#contact'>Contact</a> </li> <li> <a href='/careers'>Careers</a> </li> <li> <a href='/blog'>Blog</a> </li> <li class=hydra-theme> <a href='http://hydra.agoragames.com'> <img alt=Hydra width=92 src="/assets/images/hydra-wordmark-6248cf07.svg"/> </a> </li> </ul> </section> </nav> </div> <div class=row> <div class=columns> <h1 class=blog-page-title> <a href="/blog">The <strong>Blog</strong> </a></h1> </div> </div> <div class=row> <div class='columns large-9'> <div class=blog-page-subtitle> <h2>Posts from November 17, 2010 </h2> </div> <div class=blog-entry-list><div class=blog-entry> <div class=blog__date> Nov 17 </div> <div class=blog__contents> <h2 class=blog__title> <a href="/blog/2010/11/17/ssh-keys-agents-and-automation/">SSH keys, agents, and automation</a> </h2> <div class=blog__author> By <strong>Armando DiCianno</strong> </div> <div class=blog__body> <p>The basis of automating tasks with ssh is setting up your ssh-agent to hold your unlocked keys. Basically, this means never having to type in a password more than once. If you frequently ssh into, run commands on, or copy files to a remote machine, typing in a passphrase over and over gets very tedious.</p> <p>This post explores integrating one or multiple ssh keys into a normal OS X user session. You&rsquo;ll learn how to create keys, and add them to your OS X Keychain, so you never need to type in your password, after log in, and still have a high level of security.</p> <p>The author Rita Mae Brow (or Albert Einstein, as the consensus is still out, it seems) was the first that said, &ldquo;Insanity is doing the same thing over and over again but expecting different results.&rdquo; This is a quote I was thinking about today, when I automated another task related to SSH that I commonly do manually: mounting a directory on a remote server over SSH on OS X.</p> <p>SSH is one of those protocols that has a very mature suite of tools around it. There are so many wonderful, easy things to do or change that make your workflow more efficient if you use SSH. SSH has first class support in GNU/Linux distributions and Mac OSX, and it can be configured readily into a streamlined workflow.</p> <p>I use OS X at work, and GNU/Linux on my home machines. This post represents the little bit of learning I had to do to make my nice, automated Linux setup work well on OS X at work. I&rsquo;m going to go over the basics of ssh key management on OS X in this post, and follow up in another post with mounting a remote directory</p> <hr> <p>First, you should already be using ssh to log into remote machines! Hopefully, you&rsquo;re already using ssh keys. If not, here&rsquo;s a quick example about how to setup your first key. The username on my machine is &lsquo; <a href="http://en.wikipedia.org/wiki/Fafhrd_and_the_Gray_Mouser">fafhrd</a>&rsquo;, but you should replace that with your own username in the following examples. So, open up Terminal, and &hellip;</p> <p>{% gist 703566 %}</p> <p>Let&rsquo;s use ssh-add to check the keys in the agent. Note that for some commands, I use the full path. If you&rsquo;re running an install of ssh from <a href="http://www.macports.org/">MacPorts</a> or <a href="http://www.gentoo.org/proj/en/gentoo-alt/prefix/">Gentoo Prefix</a>, you may have to use the full path as well to get the built-in OS X version; this only matters for adding keys.</p> <p>{% gist 703572 %}</p> <p>Do you not see any return value? Let&rsquo;s add your key to the agent. In my case, I&rsquo;m going to add a second key, as well. The following commands will add your keys to the ssh-agent daemon (background process). However, we also want to add the keys to the OS X keychain, so that they&rsquo;re automatically unlocked for you when you log in, so we add the -K flag. This flag does not exist on a stock openssh install, only on the ssh that ships with OS X. Without that flag, the key is only added to the currently running ssh-agent. Note that I&rsquo;m adding both my keys, and you may just have one. (If your key is already in the keychain, there&rsquo;s no harm adding it again.)</p> <p>{% gist 703574 %}</p> <p>At this point, it&rsquo;s important to reboot. Alternatively, if you feel comfortable killing all instances of ssh-agent that are running, you may do so, log out, and log back in. After doing either, open Terminal again, and check for your keys.</p> <p>{% gist 703576 %}</p> <p>Great! keychain automatically unlocked the keys for you. Okay, it&rsquo;s time to try it out! If you haven&rsquo;t copied your public keys to your remote server, you should do so now. Your public key is most likely located at ~/.ssh/id<em>dsa.pub (or id</em>rsa.pub). Please be sure to use the .pub file, and not the private key! You will want to append (and not necessarily replace) the public key into the file ~/.ssh/authorized_keys, on the remote side.</p> <p>{% gist 703577 %}</p> <p>&hellip; and test:</p> <p>{% gist 703582 %}</p> <p>Nice! The uname command ran on the remote server, and retuned it&rsquo;s data. You should not have been prompted for your password as the credentials are coming straight from your agent.</p> <p>So what have you actually accomplished? All commands that can use ssh, bundled with the ssh tools (e.g. scp, sftp) or otherwise (e.g. rsync, git, svn), will now never prompt you for your ssh passphrase. This should speed up your workflow, and allow your to automate more of your work. One caveat, though: make sure to lock your workstation when you leave your desk, if you&rsquo;re in an untrusted environment, as someone can open up Terminal, and log into your remote servers easily. However, for the flexibility this automation provides, it&rsquo;s a worthwhile tradeoff.</p> <p>Let&rsquo;s take this one step further. Want to type even less, by avoiding the &ldquo;myname@&rdquo; portion of the ssh command? Create or edit ~/.ssh/config to look like the following.</p> <p>{% gist 703627 %}</p> <p>&hellip; and now test without the &ldquo;myname@&rdquo; portion.</p> <p>{% gist 703634 %}</p> <p>The username piece, for any host that matches *.fake.com, automatically uses &ldquo;myname&rdquo;. Wow, there&rsquo;s so much win right there, it brings a tear to my eye.</p> <p>In my next post, I&rsquo;m going to go over mounting remount directories over ssh on OS X. Until then: have fun!</p> </div> </div> </div> </div> </div> <div class='columns large-3'> <div class=blog-archives-sidebar> <h2>Blog archives</h2> <h3> <a href="/blog/2015/">2015</a> </h3> <ul> <li> <a href="/blog/2015/10/">October 2015</a> </li> <li> <a href="/blog/2015/03/">March 2015</a> </li> <li> <a href="/blog/2015/01/">January 2015</a> </li> </ul> <h3> <a href="/blog/2014/">2014</a> </h3> <ul> <li> <a href="/blog/2014/12/">December 2014</a> </li> <li> <a href="/blog/2014/11/">November 2014</a> </li> <li> <a href="/blog/2014/10/">October 2014</a> </li> <li> <a href="/blog/2014/08/">August 2014</a> </li> <li> <a href="/blog/2014/07/">July 2014</a> </li> <li> <a href="/blog/2014/06/">June 2014</a> </li> <li> <a href="/blog/2014/04/">April 2014</a> </li> <li> <a href="/blog/2014/03/">March 2014</a> </li> <li> <a href="/blog/2014/02/">February 2014</a> </li> <li> <a href="/blog/2014/01/">January 2014</a> </li> </ul> <h3> <a href="/blog/2013/">2013</a> </h3> <ul> <li> <a href="/blog/2013/11/">November 2013</a> </li> <li> <a href="/blog/2013/10/">October 2013</a> </li> <li> <a href="/blog/2013/09/">September 2013</a> </li> <li> <a href="/blog/2013/08/">August 2013</a> </li> <li> <a href="/blog/2013/07/">July 2013</a> </li> <li> <a href="/blog/2013/06/">June 2013</a> </li> <li> <a href="/blog/2013/05/">May 2013</a> </li> <li> <a href="/blog/2013/04/">April 2013</a> </li> <li> <a href="/blog/2013/03/">March 2013</a> </li> <li> <a href="/blog/2013/02/">February 2013</a> </li> <li> <a href="/blog/2013/01/">January 2013</a> </li> </ul> <h3> <a href="/blog/2012/">2012</a> </h3> <ul> <li> <a href="/blog/2012/12/">December 2012</a> </li> <li> <a href="/blog/2012/11/">November 2012</a> </li> <li> <a href="/blog/2012/10/">October 2012</a> </li> <li> <a href="/blog/2012/09/">September 2012</a> </li> <li> <a href="/blog/2012/08/">August 2012</a> </li> <li> <a href="/blog/2012/07/">July 2012</a> </li> <li> <a href="/blog/2012/06/">June 2012</a> </li> <li> <a href="/blog/2012/05/">May 2012</a> </li> <li> <a href="/blog/2012/04/">April 2012</a> </li> <li> <a href="/blog/2012/03/">March 2012</a> </li> <li> <a href="/blog/2012/02/">February 2012</a> </li> <li> <a href="/blog/2012/01/">January 2012</a> </li> </ul> <h3> <a href="/blog/2011/">2011</a> </h3> <ul> <li> <a href="/blog/2011/10/">October 2011</a> </li> <li> <a href="/blog/2011/09/">September 2011</a> </li> <li> <a href="/blog/2011/08/">August 2011</a> </li> <li> <a href="/blog/2011/07/">July 2011</a> </li> <li> <a href="/blog/2011/06/">June 2011</a> </li> <li> <a href="/blog/2011/05/">May 2011</a> </li> <li> <a href="/blog/2011/04/">April 2011</a> </li> <li> <a href="/blog/2011/03/">March 2011</a> </li> <li> <a href="/blog/2011/02/">February 2011</a> </li> <li> <a href="/blog/2011/01/">January 2011</a> </li> </ul> <h3> <a href="/blog/2010/">2010</a> </h3> <ul> <li> <a href="/blog/2010/12/">December 2010</a> </li> <li> <a href="/blog/2010/11/">November 2010</a> </li> <li> <a href="/blog/2010/10/">October 2010</a> </li> <li> <a href="/blog/2010/09/">September 2010</a> </li> <li> <a href="/blog/2010/08/">August 2010</a> </li> <li> <a href="/blog/2010/07/">July 2010</a> </li> <li> <a href="/blog/2010/06/">June 2010</a> </li> <li> <a href="/blog/2010/05/">May 2010</a> </li> <li> <a href="/blog/2010/04/">April 2010</a> </li> <li> <a href="/blog/2010/03/">March 2010</a> </li> <li> <a href="/blog/2010/02/">February 2010</a> </li> <li> <a href="/blog/2010/01/">January 2010</a> </li> </ul> <h3> <a href="/blog/2009/">2009</a> </h3> <ul> <li> <a href="/blog/2009/12/">December 2009</a> </li> <li> <a href="/blog/2009/11/">November 2009</a> </li> <li> <a href="/blog/2009/10/">October 2009</a> </li> <li> <a href="/blog/2009/09/">September 2009</a> </li> <li> <a href="/blog/2009/08/">August 2009</a> </li> <li> <a href="/blog/2009/07/">July 2009</a> </li> <li> <a href="/blog/2009/06/">June 2009</a> </li> <li> <a href="/blog/2009/05/">May 2009</a> </li> <li> <a href="/blog/2009/04/">April 2009</a> </li> <li> <a href="/blog/2009/03/">March 2009</a> </li> <li> <a href="/blog/2009/02/">February 2009</a> </li> <li> <a href="/blog/2009/01/">January 2009</a> </li> </ul> <h3> <a href="/blog/2008/">2008</a> </h3> <ul> <li> <a href="/blog/2008/11/">November 2008</a> </li> <li> <a href="/blog/2008/10/">October 2008</a> </li> <li> <a href="/blog/2008/09/">September 2008</a> </li> <li> <a href="/blog/2008/08/">August 2008</a> </li> </ul> </div> </div> </div> <script src="/assets/javascripts/app-8d34dc05.js" async=true></script> </body> </html>