<!DOCTYPE html> <html class=no-js lang=en> <head> <meta charset=utf-8> <meta content='width=device-width, initial-scale=1.0' name=viewport> <meta content='IE=edge,chrome=1' http-equiv=X-UA-Compatible> <title>The Strophe.js Echobot</title> <link href="/assets/stylesheets/app-081615f0.css" rel=stylesheet /> <script src="/assets/javascripts/modernizr-84a49412.js"></script> <link href='/assets/images/wb-square-e5e8663b.png' rel=icon sizes=128x128 type='image/png'> </head> <body class='blog blog_2010 blog_2010_08 blog_2010_08_05 blog_2010_08_05_the-strophe-js-echobot blog_2010_08_05_the-strophe-js-echobot_index f-topbar-fixed'> <div class='fixed raised'> <nav class=top-bar data-topbar role=navigation> <ul class=title-area> <li class=name> <h1> <a href='/'> <img alt=Agora class="wb-agora main-logo" src="/assets/images/wb-agora-b60168ae.svg"/> </a> </h1> </li> <li class='toggle-topbar menu-icon'> <a href='javascript:void(0)'> <span>Menu</span> </a> </li> </ul> <section class=top-bar-section> <ul class=right> <li> <a data-anchor href='/#about'>About</a> </li> <li> <a data-anchor href='/#team'>Team</a> </li> <li> <a href='/careers'>Careers</a> </li> <li> <a data-anchor href='/#contact'>Contact</a> </li> <li class=hydra-theme> <a href='http://hydra.agoragames.com'> <img alt=Hydra width=92 src="/assets/images/hydra-wordmark-6248cf07.svg"/> </a> </li> </ul> </section> </nav> </div> <div class=row> <div class=columns> <h1 class=blog-page-title> <a href="/blog">The <strong>Blog</strong> </a></h1> </div> </div> <div class=row> <div class='columns large-9'> <h2 class=blog__title> <a href="/blog/2010/08/05/the-strophe-js-echobot/">The Strophe.js Echobot</a> </h2> <div class=blog__author> By <strong>Armando DiCianno</strong> </div> <div class=blog__date> Thursday, August 5, 2010 </div> <div class=blog__body> <p>I&rsquo;m toying around with in-browser XMPP in order to publish information to our users in real time.  To start, I wanted to get the strophe.js echobot demo working.  I found the posted steps a bit lacking, and thus I present a more detailed procedure for how to get nginx+ejabberd+strophe.js up and running on Ubuntu 10.04 Workstation.  When we&rsquo;re finished, we&rsquo;ll test using Firefox and Empathy.</p> <p>Note: The process should be the same for a Ubuntu server, though you&rsquo;ll have to futz with hostnames and test using your workstation or something like irssi+bitlbee.</p> <p><strong>Installation</strong></p> <ol> <li>Install nginx and ejabberd</li> </ol> <pre class="highlight plaintext"><code>foo@bar$ sudo apt-get install ejabberd nginx curl
</code></pre> <ol> <li>Download strophe.js</li> </ol> <pre class="highlight plaintext"><code>foo@bar$ curl - http://code.stanziq.com/strophe/strophejs/releases/strophejs-1.0.1.tar.gz
</code></pre> <p><strong>Verify your machine config</strong></p> <ol> <li>Verify you have an entry in your /etc/hosts file for localhost, it should look something like this (yes, silly, but lately for some reason I keep running into people who modify this incorrectly):</li> </ol> <pre class="highlight plaintext"><code>#/etc/hosts
127.0.0.1 localhost
</code></pre> <p><strong>Configuring ejabberd</strong></p> <ol> <li>Setup account admin account</li> </ol> <pre class="highlight plaintext"><code>foo@bar$ sudo ejabberdctl register admin localhost admin
</code></pre> <ol> <li>Edit /etc/ejabberd/ejabberd.cf and make the following changes.</li> </ol> <p>In the admin user section, add the username &ldquo;admin&rdquo; so that it looks like this:</p> <pre class="highlight plaintext"><code>%% ejabberd.cfg
%% Admin user
{acl, admin, {user, "admin", "localhost"}}.
</code></pre> <p>In the modules section add mod_http bind to the list of loadable modules:</p> <pre class="highlight plaintext"><code>%% ejabberd.cfg
%%
{modules,
[
...
{mod_http_bind, []},
...
]
}.
</code></pre> <ol> <li>Restart ejabberd</li> </ol> <pre class="highlight plaintext"><code>foo@bar$ sudo /etc/init.d/ejabberd restart
</code></pre> <ol> <li>Verify ejabberd is working by browsing to http://localhost:5280/http-bind</li> </ol> <p><strong>Configuring nginx</strong></p> <ol> <li>Create /etc/nginx/sites-available/strophe and include the following:</li> </ol> <pre class="highlight plaintext"><code>#nginx.conf
server {
listen 8080;
server_name localhost;

location /http-bind {
proxy_buffering off;
tcp_nodelay on;
keepalive_timeout 55;
proxy_pass http://localhost:5280;
}

location / {
# This is where you place your strophejs sample.
root /var/www/strophe;
}
}
</code></pre> <p>Note: If for whatever reason the new configuration conflicts with an existing one, you can probably get by if you change the port number.  I used 8080 so that this won&#39;t conflict with the default config.</p> <ol> <li><p>Symlink the config to the sites-enabled folder <code> foo@bar$ sudo ln -s /etc/nginx/sites-available/strophe strophe </code></p></li> <li><p>Be a good little sysadmin and check your work.</p></li> </ol> <pre class="highlight plaintext"><code>foo@bar$ sudo nginx -t
the configuration file /etc/nginx/nginx.conf syntax is ok
configuration file /etc/nginx/nginx.conf test is successful
</code></pre> <ol> <li>If it passes, restart nginx</li> </ol> <pre class="highlight plaintext"><code>foo@bar$ sudo /etc/init.d/nginx restart
</code></pre> <p><strong>Setup strophe.js</strong></p> <ol> <li><p>From the directory where you downloaded strophe <code> foo@bar$ tar -xzvf strophejs-1.0.1.tar.gz foo@bar$ sudo mv strophejs-1.0.1 /var/www/strophe </code></p></li> <li><p>Modify /var/www/strophe/exampl/echobot.js <code>javascript // echobot.js var BOSH_SERVICE = &#39;http://localhost:8080/http-bind&#39; </code></p></li> </ol> <p>Test!</p> <ol> <li><p>Open Firefox and go to: <a href="http://localhost:8080/examples/echobot.html">http://localhost:8080/examples/echobot.html</a></p></li> <li><p>Enter the following:</p></li> </ol> <p>JID: admin@localhost Password: admin</p> <ol> <li><p>Click connect, it will show message like this. Strophe is connecting. Strophe is connected. ECHOBOT: Send a message to admin@localhost.local/4199388567126350847984920 to talk to me.</p></li> <li><p>Open Empathy and create a new Jabber account.</p></li> </ol> <p>Login: admin@localhost Pass: admin</p> <ol> <li><p>Initiate a new chat with the contact id shown in the web browser, in my case: admin@localhost.local/4199388567126350847984920</p></li> <li><p>Type a message, and it will appear in the browser.</p></li> </ol> <p>Done!</p> </div> </div> <div class='columns large-3'> <div class=blog-archives-sidebar> <h2>Blog archives</h2> <h3> <a href="/blog/2015/">2015</a> </h3> <ul> <li> <a href="/blog/2015/10/">October 2015</a> </li> <li> <a href="/blog/2015/03/">March 2015</a> </li> <li> <a href="/blog/2015/01/">January 2015</a> </li> </ul> <h3> <a href="/blog/2014/">2014</a> </h3> <ul> <li> <a href="/blog/2014/12/">December 2014</a> </li> <li> <a href="/blog/2014/11/">November 2014</a> </li> <li> <a href="/blog/2014/10/">October 2014</a> </li> <li> <a href="/blog/2014/08/">August 2014</a> </li> <li> <a href="/blog/2014/07/">July 2014</a> </li> <li> <a href="/blog/2014/06/">June 2014</a> </li> <li> <a href="/blog/2014/04/">April 2014</a> </li> <li> <a href="/blog/2014/03/">March 2014</a> </li> <li> <a href="/blog/2014/02/">February 2014</a> </li> <li> <a href="/blog/2014/01/">January 2014</a> </li> </ul> <h3> <a href="/blog/2013/">2013</a> </h3> <ul> <li> <a href="/blog/2013/11/">November 2013</a> </li> <li> <a href="/blog/2013/10/">October 2013</a> </li> <li> <a href="/blog/2013/09/">September 2013</a> </li> <li> <a href="/blog/2013/08/">August 2013</a> </li> <li> <a href="/blog/2013/07/">July 2013</a> </li> <li> <a href="/blog/2013/06/">June 2013</a> </li> <li> <a href="/blog/2013/05/">May 2013</a> </li> <li> <a href="/blog/2013/04/">April 2013</a> </li> <li> <a href="/blog/2013/03/">March 2013</a> </li> <li> <a href="/blog/2013/02/">February 2013</a> </li> <li> <a href="/blog/2013/01/">January 2013</a> </li> </ul> <h3> <a href="/blog/2012/">2012</a> </h3> <ul> <li> <a href="/blog/2012/12/">December 2012</a> </li> <li> <a href="/blog/2012/11/">November 2012</a> </li> <li> <a href="/blog/2012/10/">October 2012</a> </li> <li> <a href="/blog/2012/09/">September 2012</a> </li> <li> <a href="/blog/2012/08/">August 2012</a> </li> <li> <a href="/blog/2012/07/">July 2012</a> </li> <li> <a href="/blog/2012/06/">June 2012</a> </li> <li> <a href="/blog/2012/05/">May 2012</a> </li> <li> <a href="/blog/2012/04/">April 2012</a> </li> <li> <a href="/blog/2012/03/">March 2012</a> </li> <li> <a href="/blog/2012/02/">February 2012</a> </li> <li> <a href="/blog/2012/01/">January 2012</a> </li> </ul> <h3> <a href="/blog/2011/">2011</a> </h3> <ul> <li> <a href="/blog/2011/10/">October 2011</a> </li> <li> <a href="/blog/2011/09/">September 2011</a> </li> <li> <a href="/blog/2011/08/">August 2011</a> </li> <li> <a href="/blog/2011/07/">July 2011</a> </li> <li> <a href="/blog/2011/06/">June 2011</a> </li> <li> <a href="/blog/2011/05/">May 2011</a> </li> <li> <a href="/blog/2011/04/">April 2011</a> </li> <li> <a href="/blog/2011/03/">March 2011</a> </li> <li> <a href="/blog/2011/02/">February 2011</a> </li> <li> <a href="/blog/2011/01/">January 2011</a> </li> </ul> <h3> <a href="/blog/2010/">2010</a> </h3> <ul> <li> <a href="/blog/2010/12/">December 2010</a> </li> <li> <a href="/blog/2010/11/">November 2010</a> </li> <li> <a href="/blog/2010/10/">October 2010</a> </li> <li> <a href="/blog/2010/09/">September 2010</a> </li> <li> <a href="/blog/2010/08/">August 2010</a> </li> <li> <a href="/blog/2010/07/">July 2010</a> </li> <li> <a href="/blog/2010/06/">June 2010</a> </li> <li> <a href="/blog/2010/05/">May 2010</a> </li> <li> <a href="/blog/2010/04/">April 2010</a> </li> <li> <a href="/blog/2010/03/">March 2010</a> </li> <li> <a href="/blog/2010/02/">February 2010</a> </li> <li> <a href="/blog/2010/01/">January 2010</a> </li> </ul> <h3> <a href="/blog/2009/">2009</a> </h3> <ul> <li> <a href="/blog/2009/12/">December 2009</a> </li> <li> <a href="/blog/2009/11/">November 2009</a> </li> <li> <a href="/blog/2009/10/">October 2009</a> </li> <li> <a href="/blog/2009/09/">September 2009</a> </li> <li> <a href="/blog/2009/08/">August 2009</a> </li> <li> <a href="/blog/2009/07/">July 2009</a> </li> <li> <a href="/blog/2009/06/">June 2009</a> </li> <li> <a href="/blog/2009/05/">May 2009</a> </li> <li> <a href="/blog/2009/04/">April 2009</a> </li> <li> <a href="/blog/2009/03/">March 2009</a> </li> <li> <a href="/blog/2009/02/">February 2009</a> </li> <li> <a href="/blog/2009/01/">January 2009</a> </li> </ul> <h3> <a href="/blog/2008/">2008</a> </h3> <ul> <li> <a href="/blog/2008/11/">November 2008</a> </li> <li> <a href="/blog/2008/10/">October 2008</a> </li> <li> <a href="/blog/2008/09/">September 2008</a> </li> <li> <a href="/blog/2008/08/">August 2008</a> </li> </ul> </div> </div> </div> <script src="/assets/javascripts/app-8d34dc05.js" async=true></script> </body> </html>