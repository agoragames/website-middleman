<!DOCTYPE html> <html class=no-js lang=en> <head> <meta charset=utf-8> <meta content='width=device-width, initial-scale=1.0' name=viewport> <meta content='IE=edge,chrome=1' http-equiv=X-UA-Compatible> <title>Brain Matters</title> <link href="/assets/stylesheets/app-afeada04.css" rel=stylesheet /> <script src="/assets/javascripts/modernizr-84a49412.js"></script> <link href='/assets/images/wb-square-e5e8663b.png' rel=icon sizes=128x128 type='image/png'> </head> <body class='blog blog_2010 blog_2010_04 blog_2010_04_index f-topbar-fixed'> <div class='fixed raised'> <nav class=top-bar data-topbar role=navigation> <ul class=title-area> <li class=name> <h1> <a href='/'> <img alt=Agora class="wb-agora main-logo" src="/assets/images/wb-agora-b60168ae.svg"/> </a> </h1> </li> <li class='toggle-topbar menu-icon'> <a href='javascript:void(0)'> <span>Menu</span> </a> </li> </ul> <section class=top-bar-section> <ul class=right> <li> <a data-anchor href='/#about'>About</a> </li> <li> <a data-anchor href='/#team'>Team</a> </li> <li> <a href='/careers'>Careers</a> </li> <li> <a data-anchor href='/#contact'>Contact</a> </li> <li class=hydra-theme> <a href='http://hydra.agoragames.com'> <img alt=Hydra width=92 src="/assets/images/hydra-wordmark-6248cf07.svg"/> </a> </li> </ul> </section> </nav> </div> <div class=row> <div class=columns> <h1 class=blog-page-title> <a href="/blog">The <strong>Blog</strong> </a></h1> </div> </div> <div class=row> <div class='columns large-9'> <div class=blog-page-subtitle> <h2>Posts from April 2010 </h2> </div> <div class=blog-entry-list><div class=blog-entry> <div class=blog__date> Apr 28 </div> <div class=blog__contents> <h2 class=blog__title> <a href="/blog/2010/04/28/its-my-gem-in-a-box/">It's My Gem In A Box </a> </h2> <div class=blog__author> By <strong>David Czarnecki</strong> </div> <div class=blog__body> <p>Hey developers, I got something real important to give you. So just sit down, and listen.</p> <p>We recently started a number of projects, each of which will require the use of a common library. So, here&rsquo;s how it went down:</p> <p>* Create the common library as a gem using the <a href="http://github.com/technicalpickles/jeweler">jeweler</a> tool.</p> <p>* Install <a href="http://tomlea.co.uk/posts/gem-in-a-box/">Gem in a Box</a> to allow the gem to be downloaded internally by our developers using gem install.</p> <p>* Upload the common library gem.</p> <p>BLAMMO! Now every developer can pull my gem ;)</p> <p>But seriously, &ldquo;Gem in a Box&rdquo; is awesome and a great way to share gems internally at your office.</p> </div> </div> </div> <div class=blog-entry> <div class=blog__date> Apr 19 </div> <div class=blog__contents> <h2 class=blog__title> <a href="/blog/2010/04/19/packaging-for-pleasure/">Packaging For Pleasure</a> </h2> <div class=blog__author> By <strong>David Czarnecki</strong> </div> <div class=blog__body> <p>Let me be more explicit and say I&rsquo;m going to be talking about Rails application packaging. Sorry, I needed a good post title for the lulz and the page views.</p> <p>There are a few rake tasks that I&rsquo;ve been using more and more now that all of our applications are running in a shared, virtual enviroment. They are:</p> <ul> <li>rake -T     # -T, &ndash;tasks [PATTERN]            Display the tasks (matching optional PATTERN) with descriptions, then exit.</li> </ul> <p>Everyone should know and use this task at least once in their Rails-development life.</p> <ul> <li>rake rails:freeze:gems   # Lock this application to the current gems (by unpacking them into vendor/rails)</li> <li>rake gems:unpack   # Unpacks all required gems into vendor/gems.</li> <li>rake gems:unpack:dependencies   # Unpacks all required gems and their dependencies into vendor/gems.</li> </ul> <p>So, once I&rsquo;ve created my project with &ldquo;rails [project name]&rdquo;, then next thing I do is &ldquo;rake rails:freeze:gems&rdquo; to freeze the Rails gems. I&rsquo;ll enumerate the application&rsquo;s dependencies in the environment.rb file and then run &ldquo;rake gems:unpack&rdquo; to make sure those dependencies exist with the application. Example:</p> <pre class="highlight ruby"><code><span class="n">config</span><span class="p">.</span><span class="nf">gem</span> <span class="s1">'will_paginate'</span><span class="p">,</span> <span class="ss">:version</span> <span class="o">=&gt;</span> <span class="s1">'2.3.11'</span><span class="p">,</span> <span class="ss">:source</span> <span class="o">=&gt;</span> <span class="s1">'http://gemcutter.org'</span>
<span class="n">config</span><span class="p">.</span><span class="nf">gem</span> <span class="s1">'factory_girl'</span><span class="p">,</span> <span class="ss">:version</span> <span class="o">=&gt;</span> <span class="s1">'1.2.4'</span><span class="p">,</span> <span class="ss">:source</span> <span class="o">=&gt;</span> <span class="s1">'http://gemcutter.org'</span>
<span class="n">config</span><span class="p">.</span><span class="nf">gem</span> <span class="s1">'fakeweb'</span><span class="p">,</span> <span class="ss">:version</span> <span class="o">=&gt;</span> <span class="s1">'1.2.8'</span><span class="p">,</span> <span class="ss">:source</span> <span class="o">=&gt;</span> <span class="s1">'http://gemcutter.org'</span>
</code></pre> <p>Why do I like this approach? In a shared environment, it means we don&rsquo;t have to have our systems folks install any dependencies for our application to run making the application self-contained. This is mostly fine for gems that don&rsquo;t have an explicit native component. Also, in being explicit about versions of the gems that an application is using, we do not run the risk of chasing a moving target. Again, in a shared environment, if someone updates a gem on the system, it&rsquo;s probably not an issue until the one time it is and you&rsquo;re being called at 3 AM that the application is down because of a gem incompatibility change.</p> <p>That&rsquo;s it. Any other packaging dos and don&rsquo;t?</p> </div> </div> </div> <div class=blog-entry> <div class=blog__date> Apr 9 </div> <div class=blog__contents> <h2 class=blog__title> <a href="/blog/2010/04/09/as-it-turns-out-faking-it-is-ok/">As It Turns Out, Faking It Is OK</a> </h2> <div class=blog__author> By <strong>David Czarnecki</strong> </div> <div class=blog__body> <p>This post is totally SFW. That&rsquo;s all your going to get in this teaser.</p> <p><img title=when_harry_met_sally alt=when_harry_met_sally width=334 height=286 src="/assets/images/uploads/2010/04/themarketingblog_e_a001438922.JPG"/></p> <p>I just inherited an application and was adding some tests and noticed that one of the tests was randomly failing. As I dug in more, this particular controller test, in executing the controller&rsquo;s index method, was actually calling out on the intertubes to request some data. For an integration test that&rsquo;s probably OK, but my view is that unit and functional tests should be self-contained.</p> <p>Enter <a href="http://github.com/chrisk/fakeweb">Fakeweb</a>.</p> <p>&ldquo;FakeWeb is a helper for faking web requests in Ruby. It works at a global level, without modifying code or writing extensive stubs.&rdquo;</p> <p>3 lines of code later and I have a self-contained functional test that works with real data.</p> <pre class="highlight ruby"><code><span class="k">def</span> <span class="nf">setup</span>
  <span class="no">FakeWeb</span><span class="p">.</span><span class="nf">allow_net_connect</span> <span class="o">=</span> <span class="kp">false</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">teardown</span>
  <span class="no">FakeWeb</span><span class="p">.</span><span class="nf">allow_net_connect</span> <span class="o">=</span> <span class="kp">true</span>
<span class="k">end</span>

<span class="nb">test</span> <span class="s2">"should get index"</span> <span class="k">do</span>
  <span class="no">FakeWeb</span><span class="p">.</span><span class="nf">register_uri</span><span class="p">(</span><span class="ss">:get</span><span class="p">,</span> <span class="s1">'http://my.real.url.on.the.internets.com'</span><span class="p">,</span> <span class="ss">:body</span> <span class="o">=&gt;</span> <span class="no">File</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="no">File</span><span class="p">.</span><span class="nf">dirname</span><span class="p">(</span><span class="kp">__FILE__</span><span class="p">),</span> <span class="s1">'../fakeweb'</span><span class="p">,</span> <span class="s1">'some-file.xml'</span><span class="p">),</span> <span class="ss">:content_type</span> <span class="o">=&gt;</span> <span class="s2">"text/xml"</span><span class="p">)</span>

  <span class="n">get</span> <span class="ss">:index</span>
  <span class="n">assert_response</span> <span class="ss">:success</span>

 <span class="p">.</span><span class="nf">.</span><span class="o">.</span>

</code></pre> <p>All I needed to do was simply register the URI that was being referenced in my test, provide a valid (or invalid depending on the test) response, and my test will never try to access the real internet.</p> </div> </div> </div> <div class=blog-entry> <div class=blog__date> Apr 7 </div> <div class=blog__contents> <h2 class=blog__title> <a href="/blog/2010/04/07/the-importance-of-having-a-fast-test-suite/">The Importance of Having a (Fast) Test Suite</a> </h2> <div class=blog__author> By <strong>David Czarnecki</strong> </div> <div class=blog__body> <p>Speed is the name of the game. Or is it?</p> <p>I was adding another project to our Continuous Integration (CI) server that runs the test suite for a project after code is checked in and started noticing the time it takes to build certain projects. A few interesting statistics for you to noodle on.</p> <p>Average build time: ~32 seconds</p> <p>Max build time: 1 hour and 48 minutes</p> <p>There are approximately 18 projects that get built through CI and many other projects that have not been setup for CI.</p> <p>What does this tell us? Testing is not an impediment to development because it takes too long to run tests. As most test suites run in less than a minute, not running the test suite is not an option for our developers. And if you don&rsquo;t, CI sends an e-mail to the team letting everyone know you broke the build. And since our post-commit hooks for SVN and git notify our Campfire room each time code is committed, chances are you&rsquo;re going to get an earful in Campfire telling you to fix the build because your last commit broke the build.</p> <p><img title=chet_weird_science alt=chet_weird_science width=495 height=264 src="/assets/images/uploads/2010/04/Picture-17-cb856a7c.png"/></p> <p>I&rsquo;m glad nearly all of our projects have test suites that run quickly, but I also have a practical view on test suites. <strong>Above all, if nothing else, I want a test suite to exist.</strong> I want it to be there so that when I&rsquo;m adding code to the repository, the test suite is looking at me asking for more.</p> <p><img title="More tests please!" alt="More tests please!" width=188 height=203 src="/assets/images/uploads/2010/04/Picture-16-f97d6155.png"/></p> <p>About that project that takes 1 hour and 48 minutes to build? Right. Guitar Hero. It&rsquo;s a BIG project. It&rsquo;s over 3 years old. There is a LOT of code. We test A LOT of systems, e.g. accounts, clans, tournaments, leaderboards, game configurations, game integration processing, etc. I&rsquo;m OK with it taking that long to run the test suite. We have development practices that we follow for running sub-sections of the test suite when we touch the application to test our new code.</p> <p>To summarize:</p> <ul> <li>Ensure your projects have a test suite</li> <li>Run a Continuous Integration (CI) server for your projects for when developers forget to run the test suite before committing code</li> <li>Ensure your projects have a test suite</li> <li>Ensure your projects have a test suite</li> <li>Ensure your projects have a test suite</li> <li>Make sure developers know how to run part of the test suite for long-running test suites</li> <li>Ensure your projects have a test suite</li> </ul> </div> </div> </div> </div> </div> <div class='columns large-3'> <div class=blog-archives-sidebar> <h2>Blog archives</h2> <h3> <a href="/blog/2015/">2015</a> </h3> <ul> <li> <a href="/blog/2015/10/">October 2015</a> </li> <li> <a href="/blog/2015/03/">March 2015</a> </li> <li> <a href="/blog/2015/01/">January 2015</a> </li> </ul> <h3> <a href="/blog/2014/">2014</a> </h3> <ul> <li> <a href="/blog/2014/12/">December 2014</a> </li> <li> <a href="/blog/2014/11/">November 2014</a> </li> <li> <a href="/blog/2014/10/">October 2014</a> </li> <li> <a href="/blog/2014/08/">August 2014</a> </li> <li> <a href="/blog/2014/07/">July 2014</a> </li> <li> <a href="/blog/2014/06/">June 2014</a> </li> <li> <a href="/blog/2014/04/">April 2014</a> </li> <li> <a href="/blog/2014/03/">March 2014</a> </li> <li> <a href="/blog/2014/02/">February 2014</a> </li> <li> <a href="/blog/2014/01/">January 2014</a> </li> </ul> <h3> <a href="/blog/2013/">2013</a> </h3> <ul> <li> <a href="/blog/2013/11/">November 2013</a> </li> <li> <a href="/blog/2013/10/">October 2013</a> </li> <li> <a href="/blog/2013/09/">September 2013</a> </li> <li> <a href="/blog/2013/08/">August 2013</a> </li> <li> <a href="/blog/2013/07/">July 2013</a> </li> <li> <a href="/blog/2013/06/">June 2013</a> </li> <li> <a href="/blog/2013/05/">May 2013</a> </li> <li> <a href="/blog/2013/04/">April 2013</a> </li> <li> <a href="/blog/2013/03/">March 2013</a> </li> <li> <a href="/blog/2013/02/">February 2013</a> </li> <li> <a href="/blog/2013/01/">January 2013</a> </li> </ul> <h3> <a href="/blog/2012/">2012</a> </h3> <ul> <li> <a href="/blog/2012/12/">December 2012</a> </li> <li> <a href="/blog/2012/11/">November 2012</a> </li> <li> <a href="/blog/2012/10/">October 2012</a> </li> <li> <a href="/blog/2012/09/">September 2012</a> </li> <li> <a href="/blog/2012/08/">August 2012</a> </li> <li> <a href="/blog/2012/07/">July 2012</a> </li> <li> <a href="/blog/2012/06/">June 2012</a> </li> <li> <a href="/blog/2012/05/">May 2012</a> </li> <li> <a href="/blog/2012/04/">April 2012</a> </li> <li> <a href="/blog/2012/03/">March 2012</a> </li> <li> <a href="/blog/2012/02/">February 2012</a> </li> <li> <a href="/blog/2012/01/">January 2012</a> </li> </ul> <h3> <a href="/blog/2011/">2011</a> </h3> <ul> <li> <a href="/blog/2011/10/">October 2011</a> </li> <li> <a href="/blog/2011/09/">September 2011</a> </li> <li> <a href="/blog/2011/08/">August 2011</a> </li> <li> <a href="/blog/2011/07/">July 2011</a> </li> <li> <a href="/blog/2011/06/">June 2011</a> </li> <li> <a href="/blog/2011/05/">May 2011</a> </li> <li> <a href="/blog/2011/04/">April 2011</a> </li> <li> <a href="/blog/2011/03/">March 2011</a> </li> <li> <a href="/blog/2011/02/">February 2011</a> </li> <li> <a href="/blog/2011/01/">January 2011</a> </li> </ul> <h3> <a href="/blog/2010/">2010</a> </h3> <ul> <li> <a href="/blog/2010/12/">December 2010</a> </li> <li> <a href="/blog/2010/11/">November 2010</a> </li> <li> <a href="/blog/2010/10/">October 2010</a> </li> <li> <a href="/blog/2010/09/">September 2010</a> </li> <li> <a href="/blog/2010/08/">August 2010</a> </li> <li> <a href="/blog/2010/07/">July 2010</a> </li> <li> <a href="/blog/2010/06/">June 2010</a> </li> <li> <a href="/blog/2010/05/">May 2010</a> </li> <li> <a href="/blog/2010/04/">April 2010</a> </li> <li> <a href="/blog/2010/03/">March 2010</a> </li> <li> <a href="/blog/2010/02/">February 2010</a> </li> <li> <a href="/blog/2010/01/">January 2010</a> </li> </ul> <h3> <a href="/blog/2009/">2009</a> </h3> <ul> <li> <a href="/blog/2009/12/">December 2009</a> </li> <li> <a href="/blog/2009/11/">November 2009</a> </li> <li> <a href="/blog/2009/10/">October 2009</a> </li> <li> <a href="/blog/2009/09/">September 2009</a> </li> <li> <a href="/blog/2009/08/">August 2009</a> </li> <li> <a href="/blog/2009/07/">July 2009</a> </li> <li> <a href="/blog/2009/06/">June 2009</a> </li> <li> <a href="/blog/2009/05/">May 2009</a> </li> <li> <a href="/blog/2009/04/">April 2009</a> </li> <li> <a href="/blog/2009/03/">March 2009</a> </li> <li> <a href="/blog/2009/02/">February 2009</a> </li> <li> <a href="/blog/2009/01/">January 2009</a> </li> </ul> <h3> <a href="/blog/2008/">2008</a> </h3> <ul> <li> <a href="/blog/2008/11/">November 2008</a> </li> <li> <a href="/blog/2008/10/">October 2008</a> </li> <li> <a href="/blog/2008/09/">September 2008</a> </li> <li> <a href="/blog/2008/08/">August 2008</a> </li> </ul> </div> </div> </div> <script src="/assets/javascripts/app-8d34dc05.js" async=true></script> </body> </html>