<!DOCTYPE html> <html class=no-js lang=en> <head> <meta charset=utf-8> <meta content='width=device-width, initial-scale=1.0' name=viewport> <meta content='IE=edge,chrome=1' http-equiv=X-UA-Compatible> <title>Brain Matters</title> <link href="/assets/stylesheets/app-0c494247.css" rel=stylesheet /> <script src="/assets/javascripts/modernizr-84a49412.js"></script> <link href='/assets/images/favicon.ico' rel='shortcut icon'> </head> <body class='blog blog_page blog_page_22 blog_page_22_index f-topbar-fixed'> <div class='fixed raised'> <nav class=top-bar data-topbar role=navigation> <ul class=title-area> <li class=name> <h1> <a href='/'> <img alt="Agora Games" class=main-logo src="/assets/images/agoragames-new-8534f601.svg"/> </a> </h1> </li> <li class='toggle-topbar menu-icon'> <a href='javascript:void(0)'> <span>Menu</span> </a> </li> </ul> <section class=top-bar-section> <ul class=right> <li> <a data-anchor href='/#about'>About</a> </li> <li> <a data-anchor href='/#team'>Team</a> </li> <li> <a data-anchor href='/#contact'>Contact</a> </li> <li> <a href='/careers'>Careers</a> </li> <li> <a href='/blog'>Blog</a> </li> <li class=hydra-theme> <a href='http://hydra.agoragames.com'> <img alt=Hydra width=92 src="/assets/images/hydra-wordmark-6248cf07.svg"/> </a> </li> </ul> </section> </nav> </div> <div class=row> <div class=columns> <h1 class=blog-page-title> <a href="/blog">The <strong>Blog</strong> </a></h1> </div> </div> <div class=row> <div class='columns large-9'> <div class=blog-entry-list><div class=blog-entry> <div class=blog__date> Jul 29 </div> <div class=blog__contents> <h2 class=blog__title> <a href="/blog/2010/07/29/brightercove/">Brightercove</a> </h2> <div class=blog__author> By <strong>David Czarnecki</strong> </div> <div class=blog__body> <p>We&rsquo;re using <a href="http://www.brightcove.com/en/">Brightcove</a> here at Agora Games for some video platform work. In our group chats, we&rsquo;ve talked about, &ldquo;It would be nice if we had a Ruby API for interacting with Brightcove.&rdquo;</p> <p>And so I did just that, <a href="http://github.com/agoragames/brightcove">http://github.com/agoragames/brightcove</a></p> <pre class="highlight ruby"><code><span class="n">sudo</span> <span class="n">gem</span> <span class="n">install</span> <span class="n">brightcove</span><span class="o">-</span><span class="n">api</span>

<span class="o">&gt;&gt;</span> <span class="nb">require</span> <span class="s1">'brightcove-api'</span>
<span class="o">=&gt;</span> <span class="kp">true</span>
<span class="o">&gt;&gt;</span> <span class="n">brightcove</span> <span class="o">=</span> <span class="no">Brightcove</span><span class="o">::</span><span class="no">API</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="s1">'0Z2dtxTdJAxtbZ-d0U7Bhio2V1Rhr5Iafl5FFtDPY8E.'</span><span class="p">)</span>
<span class="o">=&gt;</span> <span class="c1">#</span>
<span class="o">&gt;&gt;</span> <span class="n">response</span> <span class="o">=</span> <span class="n">brightcove</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="s1">'find_all_videos'</span><span class="p">,</span> <span class="p">{</span><span class="ss">:page_size</span> <span class="o">=&gt;</span> <span class="mi">3</span><span class="p">,</span> <span class="ss">:video_fields</span> <span class="o">=&gt;</span> <span class="s1">'id,name,linkURL,linkText'</span><span class="p">})</span>
<span class="o">=&gt;</span> <span class="p">{</span><span class="s2">"items"</span><span class="o">=&gt;</span><span class="p">[{</span><span class="s2">"name"</span><span class="o">=&gt;</span><span class="s2">"Documentarian Skydiving"</span><span class="p">,</span> <span class="s2">"id"</span><span class="o">=&gt;</span><span class="mi">496518762</span><span class="p">,</span> <span class="s2">"linkText"</span><span class="o">=&gt;</span><span class="kp">nil</span><span class="p">,</span> <span class="s2">"linkURL"</span><span class="o">=&gt;</span><span class="kp">nil</span><span class="p">},</span> <span class="p">{</span><span class="s2">"name"</span><span class="o">=&gt;</span><span class="s2">"Surface Tricks"</span><span class="p">,</span> <span class="s2">"id"</span><span class="o">=&gt;</span><span class="mi">496518763</span><span class="p">,</span> <span class="s2">"linkText"</span><span class="o">=&gt;</span><span class="kp">nil</span><span class="p">,</span> <span class="s2">"linkURL"</span><span class="o">=&gt;</span><span class="kp">nil</span><span class="p">},</span> <span class="p">{</span><span class="s2">"name"</span><span class="o">=&gt;</span><span class="s2">"Free Skiing"</span><span class="p">,</span> <span class="s2">"id"</span><span class="o">=&gt;</span><span class="mi">496518765</span><span class="p">,</span> <span class="s2">"linkText"</span><span class="o">=&gt;</span><span class="kp">nil</span><span class="p">,</span> <span class="s2">"linkURL"</span><span class="o">=&gt;</span><span class="kp">nil</span><span class="p">}],</span> <span class="s2">"page_number"</span><span class="o">=&gt;</span><span class="mi">0</span><span class="p">,</span> <span class="s2">"page_size"</span><span class="o">=&gt;</span><span class="mi">3</span><span class="p">,</span> <span class="s2">"total_count"</span><span class="o">=&gt;-</span><span class="mi">1</span><span class="p">}</span>
</code></pre> </div> </div> </div> <div class=blog-entry> <div class=blog__date> Jul 28 </div> <div class=blog__contents> <h2 class=blog__title> <a href="/blog/2010/07/28/grabbing-the-rabbit-by-the-horns/">Grabbing the Rabbit by the Horns</a> </h2> <div class=blog__author> By <strong>Aaron Westendorf</strong> </div> <div class=blog__body> <p>RabbitMQ is a very powerful tool, especially when deployed in a cluster. Among RabbitMQ&rsquo;s more useful features is rabbitmqctl, the command line tool which can be used to query a node and list its exchanges, queues, connections, number of consumers, memory usage and more.</p> <p>The application, and cluster deployment in general, is hamstrung by Erlang&rsquo;s standard approach to cookies. The cookie, typically .erlang.cookie in the HOME directory of an application, must have only user read permissions. For a Linux RabbitMQ install, that would look like this:</p> <pre class="highlight plaintext"><code>bofh@rabbit_host1:~$ ls -al /var/lib/rabbitmq/
total 333
drwxr-xr-x 3 rabbitmq rabbitmq 160 2010-07-12 17:49 .
drwxr-xr-x 37 root root 1008 2010-07-02 14:29 ..
-r-------- 1 rabbitmq rabbitmq 20 2010-05-04 20:44 .erlang.cookie
drwxr-xr-x 3 rabbitmq rabbitmq 72 2010-05-04 20:49 mnesia
-rw-r--r-- 1 rabbitmq rabbitmq 27 2010-07-12 17:49 pids
</code></pre> <p>Any variation on these permissions and Erlang will refuse to start. The permissions requirement is embedded into Erlang itself, making it more or less impossible to work around. This creates the following problems:</p> <ul> <li>You must copy this file (or its contents) to all hosts in the cluster</li> <li>All users of rabbitmqctl must run it as sudo</li> <li>All monitoring tools must also run as root or have sudo capability</li> <li>You must have the cookie file present on the host running rabbitmqctl</li> </ul> <p>Given how powerful rabbitmqctl is, you will likely still want to limit access to it, but this can be readily accomplished with standard Unix permissions. By expanding who can use it and where, your system administrator will be thrilled to reduce need for sudo access and your customers will be happy with the additional tools you can deploy to monitor your cluster and its clients to ensure that all is well, 24/7.</p> <p>Thankfully, RabbitMQ&rsquo;s scripts accept a lot of environment variables which can be passed into the Erlang runtime, and Erlang kindly provides a way to bypass the cookie file through a command line literal. The scripts are all located in the scripts directory inside your RabbitMQ installation.</p> <pre class="highlight plaintext"><code>bofh@rabbit_host:~$ ls -ald `erl -eval 'io:format("~s~n", [code:lib_dir()])' -s init stop -noshell`/rabbitmq-server\*/scripts
drwxr-xr-x 2 root root 520 2010-07-21 14:47 /usr/local/lib/erlang/lib/rabbitmq-server-1.7.0/scripts
drwxr-xr-x 2 root root 520 2010-07-21 16:15 /usr/local/lib/erlang/lib/rabbitmq-server-1.7.2/scripts
</code></pre> <p>The three standard scripts, rabbitmq-server, rabbitmq-multi and rabbitmqctl all source an environment script, rabbitmq-env, which in turn will source the file /etc/rabbitmq/rabbitmq.conf if it exists. This is the file that you can edit to take control of your RabbitMQ cluster.</p> <pre class="highlight plaintext"><code>SERVER_START_ARGS="+K true +A300 +P512000 -setcookie NOMNOMNOMYUMYUM -kernel inet_default_listen_options [{nodelay,true},{sndbuf,32768},{recbuf,32768}]"
MULTI_START_ARGS="-setcookie NOMNOMNOMYUMYUM"
CTL_ERL_ARGS="-setcookie NOMNOMNOMYUMYUM"
</code></pre> <p>The value of each environment variable will be passed verbatim to the Erlang runtime. The <code>SERVER_START_ARGS</code> are passed to each node started by rabbitmq-multi, and directly affect the performance of a RabbitMQ instance. In this example, we have increased the number of native threads available to Erlang and allowed it to spin up numerous (Erlang) processes. We have also instructed the kernel to increase its TCP buffer sizes and disable Nagle&rsquo;s algorithm.</p> <p>You can now run rabbitmqctl without sudo on any host which has this same configuration deployed. This solution still requires that you synchronize /etc/rabbitmq across your cluster, though there are many ways of solving that problem.</p> <p>We have taken this a step further and enabled rabbitmqctl on any host in our network. All of our core software is deployed from source to /usr/local over NFS. We have deployed the rabbitmq.conf file there too, and have a small shell script wrapping rabbitmqctl.</p> <pre class="highlight shell"><code><span class="c">#!/bin/bash</span>
<span class="nv">ERL_PATH</span><span class="o">=</span><span class="sb">`</span>erl -eval <span class="s1">'io:format("~s~n", [code:lib_dir()])'</span> -s init stop -noshell<span class="sb">`</span>
<span class="nv">LATEST_VERSION</span><span class="o">=</span><span class="sb">`</span>ls <span class="nv">$ERL_PATH</span> | grep rabbitmq | sort | tail -1<span class="sb">`</span>
<span class="nv">RABBIT_PATH</span><span class="o">=</span><span class="s2">"</span><span class="nv">$ERL_PATH</span><span class="s2">/</span><span class="nv">$LATEST_VERSION</span><span class="s2">"</span>

<span class="nb">set</span> -f
<span class="o">[</span> -f /usr/local/etc/rabbitmq/rabbitmq.conf <span class="o">]</span> <span class="o">&amp;&amp;</span> . /usr/local/etc/rabbitmq/rabbitmq.conf
<span class="nb">export </span>CTL_ERL_ARGS
<span class="nv">HOME</span><span class="o">=</span>/var/lib/rabbitmq <span class="nv">$RABBIT_PATH</span>/scripts/rabbitmqctl <span class="nv">$@</span>
</code></pre> <p>We can now connect to and monitor any RabbitMQ node from any host on our network</p> <pre class="highlight plaintext"><code>bofh@gateway:~$ rabbitmqctl -n rabbit@rabbit_host1 status
Status of node rabbit@rabbit_host1 ...
[{running_applications,[{rabbit,"RabbitMQ","1.7.2"},
{mnesia,"MNESIA CXC 138 12","4.4.10"},
{os_mon,"CPO CXC 138 46","2.2.2"},
{sasl,"SASL CXC 138 11","2.1.6"},
{stdlib,"ERTS CXC 138 10","1.16.2"},
{kernel,"ERTS CXC 138 10","2.13.2"}]},
{nodes,[rabbit@rabbit_host1,rabbit@rabbit_host2]},
{running_nodes,[rabbit@rabbit_host1,rabbit@rabbit_host2]}]
...done.
</code></pre> </div> </div> </div> <div class=blog-entry> <div class=blog__date> Jul 27 </div> <div class=blog__contents> <h2 class=blog__title> <a href="/blog/2010/07/27/rails-3-0-0-rc-changes/">Rails 3.0.0.rc changes</a> </h2> <div class=blog__author> By <strong>David Czarnecki</strong> </div> <div class=blog__body> <p>Rails 3.0.0 now has a <a href="http://weblog.rubyonrails.org/2010/7/26/rails-3-0-release-candidate">release candidate</a>. These are the changes I made to a new application I am working on to clear up any deprecation warnings.</p> <p><strong>Gemfile</strong></p> <p>gem &lsquo;rails&rsquo;, &lsquo;3.0.0.rc&rsquo; gem &lsquo;haml&rsquo;, &lsquo;3.0.14&rsquo;</p> <p>Obviously you have to tell your application to use the 3.0.0.rc. Also, it seems as if haml 3.0.13, which we were previously using, had some incompatible changes with Rails 3.0.0.rc</p> <p><strong>Rakefile</strong></p> <p>Change:</p> <p>Rails::Application.load_tasks</p> <p>to:</p> <p>YourApplicationName::Application.load_tasks</p> <p><strong>config/environments/test.rb</strong></p> <p>Add:</p> <p>config.active_support.deprecation = :stderr</p> <p><strong>config/routes.rb</strong></p> <p>Change:</p> <p>YourApplicationName::Application.routes.draw do |map|</p> <p>to:</p> <p>YourApplicationName::Application.routes.draw do</p> <p>Rails 3 routing in great detail: <a href="http://www.engineyard.com/blog/2010/the-lowdown-on-routes-in-rails-3/">The Lowdown on Routes in Rails 3</a>.</p> </div> </div> </div> <div class=blog-entry> <div class=blog__date> Jun 28 </div> <div class=blog__contents> <h2 class=blog__title> <a href="/blog/2010/06/28/lifting-the-tail-inside-agora-skunk-works/">Lifting the Tail: Inside Agora Skunk Works</a> </h2> <div class=blog__author> By <strong>Aaron Westendorf</strong> </div> <div class=blog__body> <p>We&rsquo;ve been hard at work for over a year developing the next generation of game integration technology here at Agora, and over the next few months we&rsquo;ll be releasing some of the code that we&rsquo;ve developed, discussing some of the challenges we face and how we&rsquo;re using all the new technology to build the best gaming experience around.</p> <p>To start, a brief explanation of the challenges we face.  As you might imagine, we deal with a lot of data.  The volume is only increasing, and with our friends at MLG, we expect significantly more of it.  Along with the volume of data, it also comes to us in many different forms and protocols; sometimes it&rsquo;s pushed to us, and sometimes we have to go fetch it.  We have to respond to any number of business decisions made by developers and publishers, adapt to developers&#39; needs in a manner which does not negatively impact their schedule, and be a consistent and reliable partner to all our clients.  We have to deliver comprehensive documentation to both game and website developers, and our business relationships are aided by a consistent offering.  </p> <p>In the past, each game&rsquo;s services would be its own Rails application.  We built a suite of re-usable components, but for each title we would have to re-write a lot of boiler-plate code and set up an entirely new suite of servers, complete with application hosts, web and caching proxies, databases and so on.  As our data throughput grew, we found that we needed to add additional components to our stack, such as Sparrow, to turn synchronous workloads into asynchronous ones.  Each project required extensive monitoring and reporting, an interactive console for viewing production data and testing staging code.  </p> <p>We were very successful, but found the business costs too high and that we were missing several features that were important to our long term strategy of being the best in the industry at game integration.  Our experience with a virtualized hosting environment opened our eyes to the possibilities of turning our data processing and web services loose on a commoditized, shared platform.  </p> <p>With a general set of requirements in hand, we set forth, and what we came away with has been incubating, gestating and flowering into a powerful toolset that has met all our expectations, and then some.  </p> <p>Our first task was to choose the core set of technologies and the basic processing scheme that we would be using.  After an exhaustive search, lots of hacking and whiteboard scribblings, we settled on the following key features:   - Python for all application code - <a href="http://www.amqp.org">AMQP</a>, via <a href="http://www.rabbitmq.com">RabbitMQ</a>, for all inter-process communication - MySQL, Tokyo Tyrant and memcache for data storage services - Protocol translators to bridge external traffic to AMQP via a simple binary protocol - libevent for as many as IO operation as possible</p> <p><img title="lifting the tail" width=357 height=193 src="/assets/images/uploads/2010/06/lifting_the_tail-85c282ad.png"/>  </p> <p>We chose Python from the suitable dyanmic languages primarily for its memory management and speed.  We were shifting to a single-threaded multi-process environment where memory costs are high and performance paramount, and Python has an extensive pedigree in this area.  We did choose to sacrifice some memory by adhering to a single-threaded model in order to keep the application stack simple and use the kernel for all context switching.  </p> <p>AMQP&rsquo;s routing scheme gives us powerful tools to shard and aggregate traffic across our cluster.  We chose RabbitMQ because of its Erlang heritage, its performance, reliability, clustering capabilities and commercial support.  By splitting up each game&rsquo;s services into discrete packages which can each run numerous instances, we can readily divide traffic across a cluster of RabbitMQ hosts and attach listeners for monitoring, diagnostics and metrics.  The dotted-notation of AMQP&rsquo;s topic exchanges allow for routing traffic between titles, environments, services and even specific commands.  </p> <p>To get the most out of the kernel and reduce latency, we use <a href="http://monkey.org/~provos/libevent/">libevent</a> for all of our AMQP traffic and in our protocol translators.  We extensively patched the <a href="http://barryp.org/software/py-amqplib/">py-amqplib</a> to work within this asynchronous environment.  This fork has been in production use for some time now but is slated for a ground-up re-write and release into the wild.  </p> <p>We considered many other database solutions, but at the time that we had to make our decision, felt that Tokyo Tyrant was the best NoSQL database to introduce into our stack because of its sparse table capabilities, high performance, low resource usage and simple setup.  We&rsquo;re very excited with all the new development that is taking place in this field, and will be writing more about our experience with these tools over the coming years.  </p> <p>What we ended up with has met all of the goals that we set out to achieve.  We have successfully abstracted scaling, monitoring, protocol presentation and metric aggregation, allowing us to focus entirely on delivering functionality to our customers.  Now that our customers include MLG, this means that we&rsquo;ll be rolling out some of the biggest and baddest applications in the gaming community, with confidence and reliability.</p> </div> </div> </div> <div class=blog-entry> <div class=blog__date> Jun 24 </div> <div class=blog__contents> <h2 class=blog__title> <a href="/blog/2010/06/24/setting-up-a-rails-3-development-environment/">Setting Up a Rails 3 Development Environment</a> </h2> <div class=blog__author> By <strong>David Czarnecki</strong> </div> <div class=blog__body> <p>Getting started with Rails 3 development is a very straightforward process, granted you have the prerequisite version of Ruby installed on your system. <a href="http://rvm.beginrescueend.com">Ruby Version Manager</a> (RVM) is a utility that makes it very easy and painless to switch between Ruby versions while maintaining your system&rsquo;s stock Ruby installation. RVM not only enables you to switch between Ruby versions, but also maintains distinct gem sets specific to each of those versions which is very helpful when testing out new Rails environments.</p> <p>Before we jump into setup, first a bit about our pre-Rails3 environment:</p> <ul> <li>Mac OS X 10.5.8</li> <li>ruby 1.8.6 (2009-06-08 patchlevel 369) <a href=stock>universal-darwin9.0</a></li> <li>RubyGems 1.3.7</li> <li>Various older versions of Rails (2.3.8, 2.3.5, 2.3.4, 2.3.2, 2.2.2, 2.1.1, 2.1.0, 2.0.2, 1.2.6, 1.2.3)</li> </ul> <p>We will be installing the latest release of Rails which, as of this writing, is Rails 3 beta4. We will also complete setup using the latest version of Ruby 1.9. The minimal version of Ruby 1.9 required for this Rails release is 1.9.2. To complete setup with Ruby 1.8.7, consult the <a href="http://guides.rails.info/3_0_release_notes.html#rails-3-requires-at-least-ruby-187">Rails 3 release notes</a> for the minimal version requirements.</p> <p>The basic installation steps are as follows: 1. Install RVM (Ruby Version Manger) 2. Install Ruby 1.9.2 3. Install Rails3 beta4 4. Profit!</p> <p>To install, issue the following commands in a terminal window: 1. <code>bash &lt; &lt;( curl http://rvm.beginrescueend.com/releases/rvm-install-head )</code> - This is the preferred RVM installation method as described in the <a href="http://rvm.beginrescueend.com/rvm/install/">RVM installation instructions</a>.</p> <ol> <li><code>rvm install 1.9.2-head</code></li> <li><code>rvm 1.9.2-head</code></li> <li><code>gem install rails --pre</code></li> </ol> <p>Installation of the rails gem should also install it&rsquo;s respective dependencies: [05:16:50][tquackenbush@TQuackenbush ~]$ gem list</p> <p>*** LOCAL GEMS *** never abstract (1.0.0) actionmailer (3.0.0.beta4) actionpack (3.0.0.beta4) activemodel (3.0.0.beta4) activerecord (3.0.0.beta4) activeresource (3.0.0.beta4) activesupport (3.0.0.beta4) arel (0.4.0) builder (2.1.2) bundler (0.9.26) erubis (2.6.5) i18n (0.4.1) mail (2.2.5) mime-types (1.16) polyglot (0.3.1) rack (1.1.0) rack-mount (0.6.4) rack-test (0.5.4) rails (3.0.0.beta4) railties (3.0.0.beta4) rake (0.8.7) rdoc (2.5.8) thor (0.13.6) treetop (1.4.8) tzinfo (0.3.22) To test out your new installation, try creating a new bare bones Rails 3 application like so: 1. <code>rails new test_app</code> 2. <code>cd test_app</code> 3. <code>bundle install</code> - Bundler is the new default dependency manager in Rails 3, and will install any missing gems required by the project. - In my case, this was &lsquo;sqlite3-ruby (1.3.0)&rsquo;</p> <ol> <li><code>rails server</code></li> </ol> <p>As in Rails 2, this should launch a WEBrick server instance listening on localhost port 3000 with output similar to: =&gt; Booting WEBrick =&gt; Rails 3.0.0.beta4 application starting in development on http://0.0.0.0:3000 =&gt; Call with -d to detach =&gt; Ctrl-C to shutdown server [2010-06-23 16:54:06] INFO WEBrick 1.3.1 [2010-06-23 16:54:06] INFO ruby 1.9.2 (2010-06-22) [i386-darwin9.8.0] [2010-06-23 16:54:06] INFO WEBrick::HTTPServer#start: pid=6529 port=3000 And that&rsquo;s it! You&rsquo;re all ready to go with Rails 3!</p> <p><strong>Update: June 25th, 2010</strong> (David Czarnecki)</p> <p>I ran into an issue on one system where rvm and Ruby 1.9.2 were correctly installed on the system, but Rails 3 would not install. The installation would go as follows.</p> <blockquote> <p>machine-name:~ dczarnecki$ gem install rails &ndash;pre WARNING:  RubyGems 1.2+ index not found for:</p> </blockquote> <p>RubyGems will revert to legacy indexes degrading performance. I blew away the ~/.gemrc file and Rails 3 installed successfully. YMMV.</p> <p><strong>Update: June 29th, 2010</strong> (Joshua Childs) Ran into two issues with with dependencies while getting setup on my Ubuntu workstation.</p> <p>First was while problem I ran into was while following the installation steps.</p> <p>[source language=&lsquo;bash&rsquo;] # Command: josh@jagar-tharn:~$ rvm install 1.9.2-head</p> <p># Response: fail: bison is not available in your path. Please ensure it exists before compiling from head.</p> <p># Solution: sudo apt-get install bison &ldquo;`</p> <p>And the second problem I ran into was while using bundle to setup my dependencies. My workstation did not have sqlite3 installed.</p> <p>[source language=&lsquo;bash&rsquo;] # Command: josh@jagar-tharn:~/projects/test_app$ bundle install</p> <p># Response: &hellip; Using rails (3.0.0.beta4) from bundler gems Installing sqlite3-ruby (1.3.0) from rubygems repository at http://rubygems.org/ with native extensions /home/josh/.rvm/rubies/ruby-1.9.2-head/lib/ruby/1.9.1/rubygems/ext/builder.rb:46: warning: Insecure world writable dir /usr/local/libevent/ in PATH, mode 040777 /home/josh/.rvm/rubies/ruby-1.9.2-head/lib/ruby/1.9.1/rubygems/installer.rb:483:in `rescue in block in build_extensions&#39;: ERROR: Failed to build gem native extension. (Gem::Installer::ExtensionBuildError)</p> <p>/home/josh/.rvm/rubies/ruby-1.9.2-head/bin/ruby extconf.rb checking for sqlite3.h&hellip; no sqlite3.h is missing. Try &lsquo;port install sqlite3 +universal&rsquo; or &lsquo;yum install sqlite3-devel&rsquo; *** extconf.rb failed *** Could not create Makefile due to some reason, probably lack of necessary libraries and/or headers. Check the mkmf.log file for more details. You may need configuration options.</p> <p>Provided configuration options: &ndash;with-opt-dir &ndash;without-opt-dir &ndash;with-opt-include &ndash;without-opt-include=${opt-dir}/include &ndash;with-opt-lib &ndash;without-opt-lib=${opt-dir}/lib &ndash;with-make-prog &ndash;without-make-prog &ndash;srcdir=. &ndash;curdir &ndash;ruby=/home/josh/.rvm/rubies/ruby-1.9.2-head/bin/ruby &ndash;with-sqlite3-dir &ndash;without-sqlite3-dir &ndash;with-sqlite3-include &ndash;without-sqlite3-include=${sqlite3-dir}/include &ndash;with-sqlite3-lib &ndash;without-sqlite3-lib=${sqlite3-dir}/lib &hellip;</p> <p># Solution: josh@jagar-tharn:~/projects/test<em>app$ sudo apt-get install sqlite3 josh@jagar-tharn:~/projects/test</em>app$ sudo apt-get install libsqlite3-dev &rdquo;`</p> </div> </div> </div> <div class=blog-entry> <div class=blog__date> May 25 </div> <div class=blog__contents> <h2 class=blog__title> <a href="/blog/2010/05/25/my-testing-environmen/">My Rails dev environment</a> </h2> <div class=blog__author> By <strong>Brian Corrigan</strong> </div> <div class=blog__body> <p>I love reading about the way people set up their development environments. I recently started working on a new project at work and had to set everything up from scratch. Here&rsquo;s my setup.</p> <p>First, install some gems.</p> <pre class="highlight plaintext"><code># On all systems
sudo gem install ZenTest
sudo gem install redgreen
sudo gem install autotest-rails
sudo gem install shoulda
sudo gem install factory_girl

# Only on my OSX machine
sudo gem install autotest-growl
sudo gem install autotest-fsevent

# Only on my Ubuntu machine
sudo gem install test_notifier
sudo apt-get install libnotify-bin
</code></pre> <p>Next, I setup my ~/.autotest file:</p> <pre class="highlight ruby"><code><span class="c1">#!/bin/ruby</span>
<span class="nb">require</span> <span class="s1">'redgreen/autotest'</span>
<span class="nb">require</span> <span class="s1">'autotest/timestamp'</span>
<span class="nb">require</span> <span class="s2">"autotest/restart"</span>

<span class="c1">#Only Ubuntu</span>
<span class="nb">require</span> <span class="s2">"test_notifier/autotest"</span>

<span class="c1">#Only OSX</span>
<span class="nb">require</span> <span class="s2">"autotest/growl"</span>
<span class="nb">require</span> <span class="s1">'autotest/fsevent'</span>

<span class="c1"># All machines</span>
<span class="no">Autotest</span><span class="p">.</span><span class="nf">add_hook</span> <span class="ss">:initialize</span> <span class="k">do</span> <span class="o">|</span><span class="n">autotest</span><span class="o">|</span>
  <span class="sx">%w{.git .svn .hg .DS_Store ._\* vendor tmp log doc}</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">exception</span><span class="o">|</span>
    <span class="n">autotest</span><span class="p">.</span><span class="nf">add_exception</span><span class="p">(</span><span class="n">exception</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre> <p>Also, I really like git instaweb. I sent it to G, our brilliant (ex)intern and he likes it too. To start it I use:</p> <pre class="highlight plaintext"><code>git instaweb -d webrick --start
</code></pre> <p>You can automate this by adding the following to your ~/.gitconfig:</p> <pre class="highlight plaintext"><code>[instaweb]
httpd=webrick
</code></pre> <p>You can also add a port option (port=8000) if you want.</p> <p>Also, to stop instaweb, from the git repo that you started instaweb from run:</p> <pre class="highlight plaintext"><code>git instaweb stop
</code></pre> <p>Finally, I tend to branch a lot and store them server-side. I like tracking branches to automatically push/pull changes to a branch from a remote repository. All this really does is add a few lines to your .gitconfig, but hey, who doesn&rsquo;t like a shortcut.</p> <pre class="highlight plaintext"><code>git branch --track branch remote
</code></pre> <p>Last but not least, the Cheat gem is awesome. It&rsquo;s like man, but distilled to the things you&rsquo;ll actually use. (It&rsquo;s actually where I read about instaweb) Use it!</p> <pre class="highlight plaintext"><code>sudo gem install cheat
</code></pre> <p>So in general, that&rsquo;s the interesting bits of my environment. How about yours?</p> </div> </div> </div> <div class=blog-entry> <div class=blog__date> May 17 </div> <div class=blog__contents> <h2 class=blog__title> <a href="/blog/2010/05/17/browsers-and-status-204/">Browsers and Status: 204</a> </h2> <div class=blog__author> By <strong>Jason LaPorte</strong> </div> <div class=blog__body> <p><em>Trivia: The HTTP RFC asks browsers to NOT update the browser page when 204 status codes are received.</em></p> <p>Holy crap is this visually confusing; even Firebug returns nothing! That said, it&rsquo;s a perfect example of why performing only in-browser testing fails miserably. Functional tests.. use em!</p> </div> </div> </div> <div class=blog-entry> <div class=blog__date> May 13 </div> <div class=blog__contents> <h2 class=blog__title> <a href="/blog/2010/05/13/rubyreversibleencryption/">Ruby Reversible Encryption</a> </h2> <div class=blog__author> By <strong>An Engineer</strong> </div> <div class=blog__body> <p>It&rsquo;s been awhile since I had to do anything with reversible encryption. Here&rsquo;s a working sample using AES.</p> <pre class="highlight ruby"><code><span class="c1">#/usr/bin/ruby</span>
<span class="nb">require</span> <span class="s1">'openssl'</span>
<span class="nb">require</span> <span class="s2">"base64"</span>
<span class="nb">require</span> <span class="s1">'uri'</span>

<span class="c1"># First lets encrypt the string!</span>
<span class="n">plaintext</span> <span class="o">=</span> <span class="s1">'Super secret message'</span>

<span class="c1"># Create the cipher</span>
<span class="n">cipher</span> <span class="o">=</span> <span class="no">OpenSSL</span><span class="o">::</span><span class="no">Cipher</span><span class="o">::</span><span class="no">Cipher</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="s2">"aes-256-cbc"</span><span class="p">)</span>
<span class="n">cipher</span><span class="p">.</span><span class="nf">encrypt</span> <span class="c1"># Tell OpenSSL to operate in encrypt mode</span>
<span class="nb">puts</span> <span class="s2">"Cipher wants a key that is </span><span class="si">#{</span><span class="n">cipher</span><span class="p">.</span><span class="nf">key_len</span><span class="si">}</span><span class="s2">"</span>
<span class="n">key</span> <span class="o">=</span> <span class="s1">'01234567890123456789012345678901'</span>
<span class="n">cipher</span><span class="p">.</span><span class="nf">key</span> <span class="o">=</span> <span class="n">key</span>

<span class="nb">puts</span> <span class="s2">"Cipher wants an initialization vector that is </span><span class="si">#{</span><span class="n">cipher</span><span class="p">.</span><span class="nf">iv_len</span><span class="si">}</span><span class="s2">"</span>
<span class="n">cipher</span><span class="p">.</span><span class="nf">iv</span> <span class="o">=</span> <span class="n">iv</span> <span class="o">=</span> <span class="n">cipher</span><span class="p">.</span><span class="nf">random_iv</span> <span class="c1"># Create and set a random initialization vector</span>

<span class="c1"># Encrypted</span>
<span class="n">encrypted</span> <span class="o">=</span> <span class="n">cipher</span><span class="p">.</span><span class="nf">update</span><span class="p">(</span><span class="n">plaintext</span><span class="p">)</span> <span class="o">+</span> <span class="n">cipher</span><span class="p">.</span><span class="nf">final</span>
<span class="n">encrypted</span> <span class="o">=</span> <span class="n">iv</span> <span class="o">+</span> <span class="n">encrypted</span> <span class="c1"># Send along the IV</span>

<span class="c1"># Lets pretty up the encrypted string</span>
<span class="n">encrypted</span> <span class="o">=</span> <span class="no">Base64</span><span class="p">.</span><span class="nf">encode64</span><span class="p">(</span><span class="n">encrypted</span><span class="p">)</span>
<span class="c1">#encrypted = URI.escape(encrypted, Regexp.new("[^#{URI::PATTERN::UNRESERVED}]"))</span>
<span class="n">encrypted</span> <span class="o">=</span> <span class="no">URI</span><span class="p">.</span><span class="nf">escape</span><span class="p">(</span><span class="n">encrypted</span><span class="p">)</span>



<span class="c1"># Now lets unencrypt it, first start with a new cipher</span>
<span class="n">cipher</span> <span class="o">=</span> <span class="no">OpenSSL</span><span class="o">::</span><span class="no">Cipher</span><span class="o">::</span><span class="no">Cipher</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="s2">"aes-256-cbc"</span><span class="p">)</span>
<span class="n">cipher</span><span class="p">.</span><span class="nf">decrypt</span> <span class="c1"># Use SSL in decrypt mode</span>
<span class="n">cipher</span><span class="p">.</span><span class="nf">key</span> <span class="o">=</span> <span class="n">key</span>
<span class="n">encrypted</span> <span class="o">=</span> <span class="no">URI</span><span class="p">.</span><span class="nf">unescape</span><span class="p">(</span><span class="n">encrypted</span><span class="p">)</span>
<span class="n">encrypted</span> <span class="o">=</span> <span class="no">Base64</span><span class="p">.</span><span class="nf">decode64</span><span class="p">(</span><span class="n">encrypted</span><span class="p">)</span>
<span class="n">cipher</span><span class="p">.</span><span class="nf">iv</span> <span class="o">=</span> <span class="n">encrypted</span><span class="p">.</span><span class="nf">slice!</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">16</span><span class="p">)</span> <span class="c1"># Remove the IV from the encrypted data</span>
<span class="n">decrypted</span> <span class="o">=</span> <span class="n">cipher</span><span class="p">.</span><span class="nf">update</span><span class="p">(</span><span class="n">encrypted</span><span class="p">)</span> <span class="o">+</span> <span class="n">cipher</span><span class="p">.</span><span class="nf">final</span>

<span class="c1"># Test</span>
<span class="nb">puts</span> <span class="s1">'The original was '</span><span class="o">+</span> <span class="n">plaintext</span>
<span class="nb">puts</span> <span class="s1">'Encrypted that was '</span> <span class="o">+</span> <span class="n">encrypted</span>
<span class="nb">puts</span> <span class="s1">'Decrypted we have '</span> <span class="o">+</span> <span class="n">decrypted</span>
</code></pre> </div> </div> </div> <div class=blog-entry> <div class=blog__date> Apr 28 </div> <div class=blog__contents> <h2 class=blog__title> <a href="/blog/2010/04/28/its-my-gem-in-a-box/">It's My Gem In A Box </a> </h2> <div class=blog__author> By <strong>David Czarnecki</strong> </div> <div class=blog__body> <p>Hey developers, I got something real important to give you. So just sit down, and listen.</p> <p>We recently started a number of projects, each of which will require the use of a common library. So, here&rsquo;s how it went down:</p> <p>* Create the common library as a gem using the <a href="http://github.com/technicalpickles/jeweler">jeweler</a> tool.</p> <p>* Install <a href="http://tomlea.co.uk/posts/gem-in-a-box/">Gem in a Box</a> to allow the gem to be downloaded internally by our developers using gem install.</p> <p>* Upload the common library gem.</p> <p>BLAMMO! Now every developer can pull my gem ;)</p> <p>But seriously, &ldquo;Gem in a Box&rdquo; is awesome and a great way to share gems internally at your office.</p> </div> </div> </div> <div class=blog-entry> <div class=blog__date> Apr 19 </div> <div class=blog__contents> <h2 class=blog__title> <a href="/blog/2010/04/19/packaging-for-pleasure/">Packaging For Pleasure</a> </h2> <div class=blog__author> By <strong>David Czarnecki</strong> </div> <div class=blog__body> <p>Let me be more explicit and say I&rsquo;m going to be talking about Rails application packaging. Sorry, I needed a good post title for the lulz and the page views.</p> <p>There are a few rake tasks that I&rsquo;ve been using more and more now that all of our applications are running in a shared, virtual enviroment. They are:</p> <ul> <li>rake -T     # -T, &ndash;tasks [PATTERN]            Display the tasks (matching optional PATTERN) with descriptions, then exit.</li> </ul> <p>Everyone should know and use this task at least once in their Rails-development life.</p> <ul> <li>rake rails:freeze:gems   # Lock this application to the current gems (by unpacking them into vendor/rails)</li> <li>rake gems:unpack   # Unpacks all required gems into vendor/gems.</li> <li>rake gems:unpack:dependencies   # Unpacks all required gems and their dependencies into vendor/gems.</li> </ul> <p>So, once I&rsquo;ve created my project with &ldquo;rails [project name]&rdquo;, then next thing I do is &ldquo;rake rails:freeze:gems&rdquo; to freeze the Rails gems. I&rsquo;ll enumerate the application&rsquo;s dependencies in the environment.rb file and then run &ldquo;rake gems:unpack&rdquo; to make sure those dependencies exist with the application. Example:</p> <pre class="highlight ruby"><code><span class="n">config</span><span class="p">.</span><span class="nf">gem</span> <span class="s1">'will_paginate'</span><span class="p">,</span> <span class="ss">:version</span> <span class="o">=&gt;</span> <span class="s1">'2.3.11'</span><span class="p">,</span> <span class="ss">:source</span> <span class="o">=&gt;</span> <span class="s1">'http://gemcutter.org'</span>
<span class="n">config</span><span class="p">.</span><span class="nf">gem</span> <span class="s1">'factory_girl'</span><span class="p">,</span> <span class="ss">:version</span> <span class="o">=&gt;</span> <span class="s1">'1.2.4'</span><span class="p">,</span> <span class="ss">:source</span> <span class="o">=&gt;</span> <span class="s1">'http://gemcutter.org'</span>
<span class="n">config</span><span class="p">.</span><span class="nf">gem</span> <span class="s1">'fakeweb'</span><span class="p">,</span> <span class="ss">:version</span> <span class="o">=&gt;</span> <span class="s1">'1.2.8'</span><span class="p">,</span> <span class="ss">:source</span> <span class="o">=&gt;</span> <span class="s1">'http://gemcutter.org'</span>
</code></pre> <p>Why do I like this approach? In a shared environment, it means we don&rsquo;t have to have our systems folks install any dependencies for our application to run making the application self-contained. This is mostly fine for gems that don&rsquo;t have an explicit native component. Also, in being explicit about versions of the gems that an application is using, we do not run the risk of chasing a moving target. Again, in a shared environment, if someone updates a gem on the system, it&rsquo;s probably not an issue until the one time it is and you&rsquo;re being called at 3 AM that the application is down because of a gem incompatibility change.</p> <p>That&rsquo;s it. Any other packaging dos and don&rsquo;t?</p> </div> </div> </div> </div> <div class=blog-pagination> <ul class=inline-list> <li> <a href="/blog/page/23/">« Older entries </a></li> <li>Page 22 of 28</li> <li> <a href="/blog/page/21/">Newer entries » </a></li> </ul> </div> </div> <div class='columns large-3'> <div class=blog-archives-sidebar> <h2>Blog archives</h2> <h3> <a href="/blog/2015/">2015</a> </h3> <ul> <li> <a href="/blog/2015/10/">October 2015</a> </li> <li> <a href="/blog/2015/03/">March 2015</a> </li> <li> <a href="/blog/2015/01/">January 2015</a> </li> </ul> <h3> <a href="/blog/2014/">2014</a> </h3> <ul> <li> <a href="/blog/2014/12/">December 2014</a> </li> <li> <a href="/blog/2014/11/">November 2014</a> </li> <li> <a href="/blog/2014/10/">October 2014</a> </li> <li> <a href="/blog/2014/08/">August 2014</a> </li> <li> <a href="/blog/2014/07/">July 2014</a> </li> <li> <a href="/blog/2014/06/">June 2014</a> </li> <li> <a href="/blog/2014/04/">April 2014</a> </li> <li> <a href="/blog/2014/03/">March 2014</a> </li> <li> <a href="/blog/2014/02/">February 2014</a> </li> <li> <a href="/blog/2014/01/">January 2014</a> </li> </ul> <h3> <a href="/blog/2013/">2013</a> </h3> <ul> <li> <a href="/blog/2013/11/">November 2013</a> </li> <li> <a href="/blog/2013/10/">October 2013</a> </li> <li> <a href="/blog/2013/09/">September 2013</a> </li> <li> <a href="/blog/2013/08/">August 2013</a> </li> <li> <a href="/blog/2013/07/">July 2013</a> </li> <li> <a href="/blog/2013/06/">June 2013</a> </li> <li> <a href="/blog/2013/05/">May 2013</a> </li> <li> <a href="/blog/2013/04/">April 2013</a> </li> <li> <a href="/blog/2013/03/">March 2013</a> </li> <li> <a href="/blog/2013/02/">February 2013</a> </li> <li> <a href="/blog/2013/01/">January 2013</a> </li> </ul> <h3> <a href="/blog/2012/">2012</a> </h3> <ul> <li> <a href="/blog/2012/12/">December 2012</a> </li> <li> <a href="/blog/2012/11/">November 2012</a> </li> <li> <a href="/blog/2012/10/">October 2012</a> </li> <li> <a href="/blog/2012/09/">September 2012</a> </li> <li> <a href="/blog/2012/08/">August 2012</a> </li> <li> <a href="/blog/2012/07/">July 2012</a> </li> <li> <a href="/blog/2012/06/">June 2012</a> </li> <li> <a href="/blog/2012/05/">May 2012</a> </li> <li> <a href="/blog/2012/04/">April 2012</a> </li> <li> <a href="/blog/2012/03/">March 2012</a> </li> <li> <a href="/blog/2012/02/">February 2012</a> </li> <li> <a href="/blog/2012/01/">January 2012</a> </li> </ul> <h3> <a href="/blog/2011/">2011</a> </h3> <ul> <li> <a href="/blog/2011/10/">October 2011</a> </li> <li> <a href="/blog/2011/09/">September 2011</a> </li> <li> <a href="/blog/2011/08/">August 2011</a> </li> <li> <a href="/blog/2011/07/">July 2011</a> </li> <li> <a href="/blog/2011/06/">June 2011</a> </li> <li> <a href="/blog/2011/05/">May 2011</a> </li> <li> <a href="/blog/2011/04/">April 2011</a> </li> <li> <a href="/blog/2011/03/">March 2011</a> </li> <li> <a href="/blog/2011/02/">February 2011</a> </li> <li> <a href="/blog/2011/01/">January 2011</a> </li> </ul> <h3> <a href="/blog/2010/">2010</a> </h3> <ul> <li> <a href="/blog/2010/12/">December 2010</a> </li> <li> <a href="/blog/2010/11/">November 2010</a> </li> <li> <a href="/blog/2010/10/">October 2010</a> </li> <li> <a href="/blog/2010/09/">September 2010</a> </li> <li> <a href="/blog/2010/08/">August 2010</a> </li> <li> <a href="/blog/2010/07/">July 2010</a> </li> <li> <a href="/blog/2010/06/">June 2010</a> </li> <li> <a href="/blog/2010/05/">May 2010</a> </li> <li> <a href="/blog/2010/04/">April 2010</a> </li> <li> <a href="/blog/2010/03/">March 2010</a> </li> <li> <a href="/blog/2010/02/">February 2010</a> </li> <li> <a href="/blog/2010/01/">January 2010</a> </li> </ul> <h3> <a href="/blog/2009/">2009</a> </h3> <ul> <li> <a href="/blog/2009/12/">December 2009</a> </li> <li> <a href="/blog/2009/11/">November 2009</a> </li> <li> <a href="/blog/2009/10/">October 2009</a> </li> <li> <a href="/blog/2009/09/">September 2009</a> </li> <li> <a href="/blog/2009/08/">August 2009</a> </li> <li> <a href="/blog/2009/07/">July 2009</a> </li> <li> <a href="/blog/2009/06/">June 2009</a> </li> <li> <a href="/blog/2009/05/">May 2009</a> </li> <li> <a href="/blog/2009/04/">April 2009</a> </li> <li> <a href="/blog/2009/03/">March 2009</a> </li> <li> <a href="/blog/2009/02/">February 2009</a> </li> <li> <a href="/blog/2009/01/">January 2009</a> </li> </ul> <h3> <a href="/blog/2008/">2008</a> </h3> <ul> <li> <a href="/blog/2008/11/">November 2008</a> </li> <li> <a href="/blog/2008/10/">October 2008</a> </li> <li> <a href="/blog/2008/09/">September 2008</a> </li> <li> <a href="/blog/2008/08/">August 2008</a> </li> </ul> </div> </div> </div> <script src="/assets/javascripts/app-8d34dc05.js" async=true></script> </body> </html>