<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible"><meta content="width=device-width" name="viewport"><title>Brain Matters</title><link href="../../assets/images/favicon.ico" rel="shortcut icon"><link href="../../assets/stylesheets/all-dc5d1bf2.css" media="all" rel="stylesheet" type="text/css" /><!--[if lt IE 9]><script src="../../assets/javascripts/vendor/html5shiv-8b3747c5.js" type="text/javascript"></script><![endif]--></head><body><div class="outer-wrap"><div class="inner-wrap"><div class="wrap"><header class="clearfix" id="page"><a href="/"><img alt="Agora Games" id="logo" src="../../assets/images/agora-games-logo-e99b2824.png"></a><nav><ul><li><a href="https://hydra.agoragames.com/">Products</a></li><li><a href="/portfolio.html">Customers</a></li><li><a href="/us.html">Team</a></li><li><a href="/community.html">Community</a></li><li><a href="/work-at-agora.html">Jobs</a></li><li><a href="/blog/">Blog</a></li></ul></nav></header></div><div class="wrap"><article class="clearfix"><header><h1>June 2011</h1></header><section id="blog-entries"><div class="blog-entry"><div class="date-comments"><div class="date">Jun 27</div></div><div class="blog-content"><h2><a href="/blog/2011-06-27-nerds-the-take-over.html">Nerds: The Take Over</a></h2><div class="blog-author">By <strong>Brian Corrigan</strong></div><div class="blog-body"><p>Several days ago, I was walking with my Agora Games t-shirt, which happens to bare the Major League Gaming (MLG) logo on the arm. Out of Dunkin Donuts, a young boy excitedly ran up to me. After catching his breath, he goes, “excuse me, do you compete in the MLG?” At that point I had gotten towed and was on the phone with the police so I simply shook my head no.</p>

<p>Think back to high school; remember the assortment of social groups? To name a few, we had the jocks with expectations of college sports and the major leagues. Also, we had the dramatic arts students who hoped for the big break that would land them fame and fortune. There’s no forgetting the music students who dreamed of being rap or rock stars and finally, the nerds. Sadly there was no glamorous expectation for the nerds. They were expected to do your normal jobs, working for big companies or starting their own.</p>

<p>Even when you considered the earning potential, there was still that essence of glory that was missing, unless you discovered something great. This however, started to change about eight years ago when Sundance started MLG. Today MLG is accurately described as a huge concert for gamers. The last event housed almost 15,000 while streaming to an audience of at least 22.5 million.</p>

<p>After getting my car, I started thinking of the influence that MLG has on the new generation. To young kids, MLG is right up there with other professional leagues such as the NBA or the NFL. MLG already opens doors to huge opportunities for sponsorships and endorsement deals and will only go further. Additionally, as we attract more sponsors and fans, the growth potential becomes unlimited.</p>

<p>Now consider the change that brings to that same high school scene. Finally, a means of recognition for those who lack the interest or ability to play sports, act out a scene or please a crowd with music. Now when you’re told to do something for your future, it’s arguable that you are investing in your future. So, to those siting on the couch pwning their friends in Halo, your path to glory awaits.</p>
</div></div></div><div class="blog-entry"><div class="date-comments"><div class="date">Jun 24</div></div><div class="blog-content"><h2><a href="/blog/2011-06-24-of-penguins-rabbits-and-buses.html">Of Penguins, Rabbits and Buses</a></h2><div class="blog-author">By <strong>Aaron Westendorf</strong></div><div class="blog-body"><p>Here at Agora we make use of dedicated hardware and virtual machines running on our providers' respective clouds. In recent months, we've moved our RabbitMQ hosts onto hardware because we found that we could far exceed the CPU capacity of our virtual machines and it was far cheaper to run a small cluster of hardware hosts than a giant cluster of VMs. We used an existing, underutilized host for our primary traffic while awaiting delivery and installation of a new pair servers. Expecting a simple plug-and-play swap, I set out to test the new hardware before we made the transition. What follows is a harrowing tale into the deepest depths of modern hardware architecture.</p>

<p>Our current primary RabbitMQ host, leviathan, is a 24 core Intel Xeon X5650 running at 2.67GHz and fitted with 132GB of RAM. The machine hosts all our in-memory databases, such as Redis and Memcached, and is vastly underutilized at this time. RabbitMQ is run in a cluster with other nodes hosted on VMs to give us failover capacity.</p>

<p>To replace its role as RabbitMQ host, we purchased artemis and hermes, two 24 core AMD Opteron 6172s running at 2.1GHz and fitted with 8GB of RAM each. Recent versions of RabbitMQ page queue backlogs to disk, and our traffic pattern and infrastructure validations are such that this amount or RAM is sufficient.</p>

<p>At first, one might assume that the differences in processors would result in near-equal <a href="http://www.bit-tech.net/hardware/cpus/2010/03/31/amd-opteron-6174-vs-intel-xeon-x5650-review/1">performance</a> for RabbitMQ. The Intel CPUs have faster clock cycles, but they rely on Hyper-Threading to present 24 logical cores to the operating system. The AMD CPUs are slower, but they present 24 hardware cores to the kernel. <a href="http://www.centos.org/docs/5/html/5.2/Deployment_Guide/s2-proc-cpuinfo.html">Linux</a> reports 5333 bogomips for the Xeons, 4200 for the Opterons.</p>

<p>Using <a href="https://github.com/agoragames/haigha">haigha</a>'s load testing <a href="https://github.com/agoragames/haigha/blob/master/scripts/stress_test">script</a>, we were astonished to discover that our brand-new hardware was almost 50% slower than our until-recently-brand-new Intel hardware! What could possibly have gone wrong?</p>

<p>The test that we ran consisted of 3 VM clients, each with 4 cores, each running 3 instances of the standard configuration of the <code>stress_test</code> script of 500 channels looping messages over 500 queues. That is, 4500 channels and queues, each channel publishing a message as soon as it receives its previously published message. The test would run for a fixed period of time, usually a minute.</p>

<p>Our investigation started simple enough. Using top and our new favorite, htop, we observed that the kernel was using a substantial portion of each cores capacity. We also observed that cores were underutilized, as htop clearly showed a visible gap on the right-hand side the CPU graphs. Though not scientific, it appeared to be a 10-30% loss. A bit of <a href="http://www.theregister.co.uk/2010/04/20/ubuntu_server_10_04/">research</a> implied that the Ubuntu 10.04.2 kernel, 2.6.32, was perhaps released around the same time as our AMD chips, and may not fully support them. We tested the latest patches to that release, 2.6.32-32, but did not observe any improvement.</p>

<p>Venturing into unknown territory, we installed the latest kernel backported from maverick, 2.6.35-25. We immediately observed an improvement in CPU usage, such that all cores were near 100% utilization. Sadly though, our message throughput remained nearly the same, as user space consumed only 40% of each core. Yet when comparing a single instance of <code>stress_test</code> , leviathan and artemis performed nearly equal. In no case were we able to induce any IO wait, which was to be expected since we weren't hitting disk. Why would 24 cores of AMD be so dramatically different than 24 cores of Intel?</p>

<p>With the obvious problems ruled out and the latest kernel installed, I started to dig deeper into the architectural differences between the two companies' designs. Using <a href="http://manpages.ubuntu.com/manpages/natty/man1/lscpu.1.html">lscpu</a>, we can see two very different CPU designs.</p>

<p>```
 leviathan:~$ lscpu
 Architecture: x86_64
 CPU op-mode(s): 32-bit, 64-bit
 CPU(s): 24
 Thread(s) per core: 2
 Core(s) per socket: 6
 CPU socket(s): 2
 NUMA node(s): 2
 Vendor ID: GenuineIntel
 CPU family: 6
 Model: 44
 Stepping: 2
 CPU MHz: 2666.806
 Virtualization: VT-x
 L1d cache: 32K
 L1i cache: 32K
 L2 cache: 256K
 L3 cache: 12288K</p>

<p>artemis:~$ lscpu
 Architecture: x86_64
 CPU op-mode(s): 64-bit
 CPU(s): 24
 Thread(s) per core: 1
 Core(s) per socket: 12
 CPU socket(s): 2
 NUMA node(s): 4
 Vendor ID: AuthenticAMD
 CPU family: 16
 Model: 9
 Stepping: 1
 CPU MHz: 2100.172
 Virtualization: AMD-V
 L1d cache: 64K
 L1i cache: 64K
 L2 cache: 512K
 L3 cache: 5118K
```</p>

<p>The AMD CPUs have nearly double the amount of dedicated cache per core, but a much smaller (shared) L3 cache. Though this was clearly a fundamental difference, it did not seem adequate in explaining the vast amount of time that the kernel was consuming on each CPU. Yet the only reason why the kernel would be consuming so much time, without any IO wait, would be if it was waiting for something. What would Linux be waiting for that Intel was readily delivering?</p>

<p>As I noted, our test was running 4500 unique channels and queues. In a <a href="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2011-May/012991.html">reply</a> to a recent inquiry on the RabbitMQ mailing list, I learned that both channels and queues are allocated an Erlang process. A bit of searching and I found a useful <a href="http://www.erlang.org/euc/08/euc_smp.pdf">paper</a>[PDF] on the early SMP support in Erlang R12B, circa 2008. The diagrams show a single run queue from which all schedulers pull the next process to run.</p>

<p>By R13B, each scheduler had a <a href="http://www.erlang.org/documentation/doc-5.7/doc/highlights.html">dedicated</a> run queue, vastly decreasing lock contention. Additionally, scheduling algorithms, and <a href="http://www.erlang.org/doc/man/erlang.html#system_flag-2">configuration thereof</a>, were designed specifically to take advantage of the variety of SMP architectures. RabbitMQ is running on R14B01, and so it should have the latest in SMP optimizations, particularly with respect to <a href="http://en.wikipedia.org/wiki/Non-Uniform_Memory_Access">NUMA</a>, which is how both Intel and AMD implement their SMP architectures.</p>

<p>Linux is also NUMA-aware, and contains scheduling algorithms that try to pair the core that a process or thread will use with the NUMA node where its memory is allocated. Likewise, it tries to allocate memory on the same NUMA node as the process or thread that is requesting it. This was a topic area we were already familiar with, but in terms of <a href="http://jcole.us/blog/archives/2010/09/28/mysql-swap-insanity-and-the-numa-architecture/">database applications</a> that consume most of system RAM. That clearly was not the case here, as RabbitMQ barely consumed 500MB under the stress test, and the memory is allocated on demand, and so was spread evenly across all NUMA nodes.</p>

<p>So with hardware that benchmarked well, using recent releases of the Linux kernel and Erlang VM, and an application that used a small fraction of available RAM, RabbitMQ performed abysmally slow. What could possibly cause such behavior?</p>

<p>The final piece of the puzzle lay in the nature of RabbitMQ itself. Though Erlang may try to pair a process with a node-bound scheduler, and Linux allocate memory on the same node as that scheduler, that's of little use in practice. When a message is read from a connection (itself a process) on a channel (also a process), the route of that message must be looked up in an mnesia-backed global table to determine which queue(s) the message should be copied to. Bits are allocated and written to for that queue (yet another process), and then any consumer of that queue - a channel - must read the bits before sending them out. In short, there is a near-0 chance that the bits necessary to fulfill a single publish-route-consume will be processed by the same scheduler, and a just-slightly-greater-than-0 chance that it will be processed by a scheduler on the same NUMA node. Even if the code is optimized to only copy messages as references, numerous reads and writes must acquire an exclusive lock on a NUMA nodes memory bus.</p>

<p>So what's the difference between Intel and AMD NUMA implementations?</p>

<p>```
 leviathan:~$ numactl -H
 available: 2 nodes (0-1)
 node 0 cpus: 0 2 4 6 8 10 12 14 16 18 20 22
 node 0 size: 65525 MB
 node 0 free: 59013 MB
 node 1 cpus: 1 3 5 7 9 11 13 15 17 19 21 23
 node 1 size: 65535 MB
 node 1 free: 59787 MB
 node distances:
 node 0 1
 0: 10 20
 1: 20 10</p>

<p>artemis:~$ numactl -H
 available: 4 nodes (0-3)
 node 0 cpus: 0 2 4 6 8 10
 node 0 size: 2047 MB
 node 0 free: 1621 MB
 node 1 cpus: 12 14 16 18 20 22
 node 1 size: 2044 MB
 node 1 free: 1758 MB
 node 2 cpus: 13 15 17 19 21 23
 node 2 size: 2048 MB
 node 2 free: 1806 MB
 node 3 cpus: 1 3 5 7 9 11
 node 3 size: 2047 MB
 node 3 free: 1874 MB
 node distances:
 node 0 1 2 3
 0: 10 20 20 20
 1: 20 10 20 20
 2: 20 20 10 20
 3: 20 20 20 10
```</p>

<p>The AMD cores are split across four nodes, whereas the Intel cores only use two. In the case where a process uses all cores equally, there is a 50% probability of a memory operation being local on a Xeon processor, but only a 25% probability on an Opteron!</p>

<p>Starting RabbitMQ on just 2 nodes, I instantly gained nearly 30% improvement, using half the available processing power, and kernel time dropped to a far more normal 20-30% per core. I experimented with this for a few hours, and found that 3 nodes, with memory interleave across all 4 nodes, was the optimal configuration. But what of the Erlang scheduler?</p>

<p>```
 artemis:~$ erl
 Erlang R14B01 (erts-5.8.2) [source] [64-bit] [smp:24:24] [rq:24] [async-threads:0] [hipe] [kernel-poll:false]</p>

<p>Eshell V5.8.2 (abort with ^G)
 1&gt; erlang:system_info(scheduler_bind_type).
 thread_no_node_processor_spread
```</p>

<p>Erlang is smart enough to recognize that this is a NUMA system, but the scant documentation implies that the default scheduler type is best suited to to Hyper-Threading architectures. As it turns out though, all of the scheduler types that are documented as designed for NUMA were slower than the simple <code>processor_spread</code> scheduler, which out-performed the NUMA schedulers by almost 30%. And what of the number of schedulers and <a href="http://stackoverflow.com/questions/1182025/what-do-the-erlang-emulator-info-statements-mean">request queues</a>? Though they're configured for 24 cores, experiments show that the default number of 24 is best, even given only 18 cores of execution. I can't speak to why exactly either of these two settings are best, but I can entertain any number of educated guesses.</p>

<p>The last question that remained was, if we're to run with 3 out of 4 NUMA nodes, which ones do we choose? It seemed logical to pick the ones that weren't connected directly to the network card, the only other bit of hardware which we were trying to push as many bits through as possible.</p>

<p>```
 artemis:~$ lspci -tv
 -[0000:00]-+-00.0 ATI Technologies Inc RD890 Northbridge only dual slot (2x16) PCI-e GFX Hydra part
 +-04.0-[0000:04]–+-00.0 Broadcom Corporation NetXtreme II BCM5709 Gigabit Ethernet
 | -00.1 Broadcom Corporation NetXtreme II BCM5709 Gigabit Ethernet
 +-06.0-[0000:05]–+-00.0 Broadcom Corporation NetXtreme II BCM5709 Gigabit Ethernet
 | -00.1 Broadcom Corporation NetXtreme II BCM5709 Gigabit Ethernet
 ………………….</p>

<p>artemis:~$ ifconfig
 eth1 Link encap:Ethernet HWaddr aa:aa:aa:aa:aa:aa
 inet addr:111.111.111.111 Bcast:111.111.111.111 Mask:255.255.255.255
 inet6 addr: ffff::ffff:ffff:ffff:ffff/64 Scope:Link
 UP BROADCAST RUNNING MULTICAST MTU:1500 Metric:1
 RX packets:71583284 errors:0 dropped:0 overruns:0 frame:0
 TX packets:134508244 errors:0 dropped:0 overruns:0 carrier:0
 collisions:0 txqueuelen:1000
 RX bytes:13852822249 (13.8 GB) TX bytes:23156900853 (23.1 GB)
 Interrupt:45 Memory:f4000000-f4012800</p>

<p>artemis:~$ cat /sys/bus/pci/devices/0000:04:00.1/irq
 45</p>

<p>artemis:~$ cat /sys/bus/pci/devices/0000:04:00.1/numa_node
 0
```</p>

<p>It's unclear how much of a difference that makes, but when RabbitMQ is under full load, a few of the cores on node 0 show 5-30% kernel usage, a mixture of network card and memory traffic.</p>

<p>Our final configuration looks something like this. Your installation will have these stanzas in various places depending on the distribution and how your administrator configured the runtime scripts. Note that we turned off <a href="http://www.erlang-solutions.com/thesis/tcp_optimisation/tcp_optimisation.html">async threads</a>. We didn't observe any benefit of enabling them, and it was unclear if they degraded performance.</p>

<p><code>
 SERVER_ERL_ARGS="+K true +sbtps +P 10485760"
 exec setuidgid rabbitmq numactl --cpunodebind=!0 /usr/local/sbin/rabbitmq-server
</code></p>

<p>The final result? Using only 18 AMD cores of execution, artemis achieved 93% of the performance of leviathans 24 Intel cores. Given that Linux calculated a 22% performance difference, we'll call that a win. Who can complain about two hosts capable of 40,000 messages each vs. a single host capable of 43,000?</p>

<p>What can we learn from this? Firstly, know the hardware you're buying. No matter how this played out, the Intel chips benchmarked faster, and we should have stuck with those when purchasing our RabbitMQ hosts. Second, the physical layout of the data path and the nature of your application together determine the bounds of your capacity. <em>Any</em> multithreaded application configured to use all of your cores, where the memory access pattern is not localized to a single thread, will exhibit <em>non-linear</em> performance inversely proportional to the number of NUMA nodes those threads run on.</p>
</div></div></div><div class="blog-entry"><div class="date-comments"><div class="date">Jun 23</div></div><div class="blog-content"><h2><a href="/blog/2011-06-23-hero-or-villain.html">Hero or Villain?</a></h2><div class="blog-author">By <strong>Leslie Brezslin</strong></div><div class="blog-body"><p>When we play video games, we are automatically transported into a world that stretches beyond the line of current reality. Within this world, you are granted complete freedom while omitting consequences. Many people play games because it’s a channel through which we can live out the impossible. While there are many other reasons, I question whether our attention spans are the only things being is injected into the games we play.</p>

<p>Today, many games offer the ability to play as either a good or evil character. For me, the evil character is usually more appealing. The reason is simply because I know it’s fake. I figure, hey; if you’re going to enter a fictional world, why enter as yourself? Why enter just to follow the laws and moral code of the current realm that you’re trying to escape?</p>

<p>I was curious as to see what the general consensus on the matter was, so I asked around. The answer to the question wasn’t very surprising at all. It seems like the majority of people (at least here at the office) enter gaming worlds as heroes serving the laws of “good” and fighting for justice. Some people claimed to enjoy the feeling of cleaning up the crap in this world while others did it for the honor. Those who chose the villain were those who only cared about an entertaining storyline. I however, have my own theory on the matter.</p>

<p>For many people, playing games does not eliminate the sense of morality and duty to the world’s wellbeing that we’ve been encoded to uphold. We perceive what goes on in games, as we perceive ourselves in those situations. Some of us even go as far as to subconsciously apply methods like Karma to those situations. Our moral codes enter the game along with our attention spans and we block ourselves from completely enjoying the total package.</p>

<p>So, what’s the lesson to be learned? Next time you turn on a video game, escape yourself. Forget the world on your shoulders and do as you see fit. If the color of the houses annoys you, burn down the village. You have ample time to spend as a good person in the real world.</p>

<p>Perfect Example right here —&gt; http://kotaku.com/5815150/saints-row-the-third-revels-in-the-absurd</p>
</div></div></div><div class="blog-entry"><div class="date-comments"><div class="date">Jun 22</div></div><div class="blog-content"><h2><a href="/blog/2011-06-22-secrets-to-success.html">Secrets to success</a></h2><div class="blog-author">By <strong>Mike DelPrete</strong></div><div class="blog-body"><p>Success pertains to anyone willing to grab it, however, the majority will experience it through different channels. A lot of people measure success by a person’s current status; what they have, who they know and ultimately where they are. Only, is this a correct scale upon which to measure a person’s triumphs? When measuring success, should you look at the point where a person has landed or consider the journey from where they made the initial jump?</p>

<p>Personally, I prefer to look at the whole picture as opposed to one part of it. The fact of the matter is, although all men were created equal, not all were born with the same opportunities. Ultimately, we have the potential to reach the highest form of glory as well as the lowest. That’s why my measure of success is based on analyzing the whole path that a person has traveled. Someone starting at a lower position has a lot more work to put in, but can eventually reach the highest outcome.</p>

<p>The world has many opportunities to offer and many are determined enough to recognize them. One example of this is Mike DelPrete, the CEO of Agora Games. Mike started Agora Games eight years ago and it thrived both before and after it’s acquisition by MLG. When I asked Mike what the secret to his success was, he told me to ”get back to work.” Idealistically, I took that for stay focused and continue with the task at hand. After surviving his ocean of emails, meetings and conferences, Mike specified “hard work, determination, and having an open mind.”</p>

<p>The pillars of success reside on the platform of determination. Needless to say, that platform isn’t leveled. This is one of the leading causes of the gap between those who prosper and those who fall behind. The result that you can expect to gain from any experience is positively correlated to the sacrifices that you’re willing to make. Of course some dream bigger than others, but many fail to make it through the first stage: desire. Without a constant desire for something greater, can you expect progress?</p>
</div></div></div><div class="blog-entry"><div class="date-comments"><div class="date">Jun 21</div></div><div class="blog-content"><h2><a href="/blog/2011-06-21-introducing-haigha.html">Introducing Haigha</a></h2><div class="blog-author">By <strong>Aaron Westendorf</strong></div><div class="blog-body"><p>We're pleased to announce the official release of haigha, our Python AMQP client library.</p>

<p>Haigha is the culmination of over 2 years of development. We've used RabbitMQ since we launched our <a href="http://blog.agoragames.com/blog/2010/06/28/lifting-the-tail-inside-agora-skunk-works/">game services platform</a> and immediately fell in love with it and the power that AMQP afforded us. At the time that we began development, py-amqplib was the dominant client library. It fully-supported the 0.8.1 protocol features we made use of, but because it was blocking, fell short of our desire for an asynchronous, highly-scalable messaging layer on which to build our services. At the time, only <a href="https://launchpad.net/txamqp">txAMQP</a> supported asynchronous IO and we had ruled out Twisted for a variety of reasons. Pika, the official Python client maintained by RabbitMQ, had yet to be <a href="https://github.com/pika/pika/commit/d514dce7daf10cfc727cca9095ef0d114f9e4592">born</a>.</p>

<p>With the py-amqplib source in hand, we deployed it directly into our stack and started heavily modifying it to integrate <a href="http://code.google.com/p/pyevent/">pyevent</a>. By mid-2009 we had a stable and fast fork of py-amqplib and were able to scale our HTTP&lt;&gt;AMQP bridge to tens of thousands of concurrent connections. As these things are wont to go, once we had met our needs, and our schedules demanded focus on client deliverables, our fork languished, unknown to the world and quietly shuffling gigabytes of data across our network.</p>

<p>Throughout 2010 we continually expressed a desire to release what we had done to the community at large, feeling that others could also benefit from a fast asynchronous AMQP client for their Python applications. Pika was maturing rapidly and interest was clearly growing for building the kind of applications that AMQP can support. We held out releasing anything, as the changes we had made to support event-driven IO had brought to light many problems in the layout of py-amqlib, and our fork was based on an older version of the code, before a major refactor. We felt that a ground-up re-write, with a clean and efficient architecture, was the right way to contribute back to the community and improve our own code base.</p>

<p>In the dark pre-dawn hours of Friday 24 September 2010, haigha was <a href="https://github.com/agoragames/haigha/commit/2a4f63ddc08140f4078c396d32021256ad55762d">born</a> during the 2nd Agora Games hack-a-thon. By the <a href="https://github.com/agoragames/haigha/commit/36aad0cca6686d871fe0c8923eb460de743b2504">end</a> of the day we had a working demo with architectural details in place, and continued to develop features for the next few weeks before once again putting it on hold in favor of money-making enterprises.</p>

<p>After a restful New Year vacation, we spent several weeks completing haigha, profiling and optimizing it, and integrating it into our game services stack. The transition was seamless, about the best anyone could ask given that a major component we rely upon was completely re-written and deployed against a major upgrade to RabbitMQ, as we transitioned from the 1.7 series to the 2.2 series and the 0.9.1 protocol.</p>

<p>We still felt it poor form to release without comprehensive unit tests, and momentum was building to throw away <a href="http://code.google.com/p/pymox/">pymox</a> in favor of a new <a href="http://mocha.rubyforge.org/">Mocha</a>-inspired mocking library. In another pre-dawn fit of hack-a-thon inspiration, we launched <a href="https://github.com/agoragames/chai">Chai</a>. With the right tool for the job in hand, we set about completing our unit test suite.</p>

<p>Once again, <a href="http://www.themortalkombat.com/">client deliverables</a> conspired to keep our code from finally seeing the light of day, but after the big crunch, we punched through a <a href="http://blog.agoragames.com/blog/2011/05/19/the-haigha-preview/">quietly-publicized</a> <a href="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2011-May/012861.html">preview release</a>.</p>

<p>After a few more weeks baking in the oven, we've nearly completed code coverage, fixed many bugs, and generally cleaned house. We feel that haigha is now ready for the masses, and we're proud to put it out there for the rest of the community to use. We look forward to your <a href="https://github.com/agoragames/haigha/issues">feedback</a>. You can find the source on <a href="https://github.com/agoragames/haigha">github</a> and packages on <a href="http://pypi.python.org/pypi/haigha">pypi</a>.</p>
</div></div></div><div class="blog-entry"><div class="date-comments"><div class="date">Jun 16</div></div><div class="blog-content"><h2><a href="/blog/2011-06-16-the-postman-always-rings-twice.html">The Postman Always Rings Twice</a></h2><div class="blog-author">By <strong>David Czarnecki</strong></div><div class="blog-body"><p>My colleague <a href="https://twitter.com/#!/logankoester">@logankoester</a> posed the following question in our team chat room: "Can the Github bot notify HipChat on wiki updates as well? I mean, wikis are just git repos, right? I am equally interested in documentation changes as in software changes."</p>

<p>It is possible to do this in a little bit of a roundabout way. Read on to see how I did this with <a href="http://hudson-ci.org/">Hudson</a>, our Continuous Integration server.</p>

<ul>
  <li>
    <p>We have the <a href="https://github.com/jlewallen/jenkins-hipchat-plugin">Jenkins HipChat plugin</a> installed and configured in Hudson.</p>
  </li>
  <li>
    <p>Grab the Wiki Git Access URL for your project, e.g. git@github.com:myorganization/my-project.wiki.git</p>
  </li>
  <li>
    <p>Create a new project in Hudson to monitor the project's Wiki Git repository. Relevant items to setup in the project would be as follows:</p>
  </li>
</ul>

<p>Project name: Identify in the project name that it is the Wiki for your project so as to not be confused with actual project software notifications.</p>

<p>Source code management: Set to git and use the Wiki Git Access URL for your project here.</p>

<p>Branches to build: **</p>

<p>Poll SCM: I set to check every 30 minutes. Example:</p>

<p>*/30 * * * *</p>

<p>In the Post-build actions: check the box for HipChat notification and set the name of the room to the one where notifications on Wiki changes should be sent to.</p>

<p>And you're done! If there are no changes to the wiki since the last poll, you won't get any notices from Hudson. If there are changes to the wiki since the last poll, a notification will be posted to HipChat. Folks can then click the link in Hudson to see the list of changes.</p>

<p>You can find more hilarity over on my Twitter account, <a href="http://twitter.com/czarneckid">@CzarneckiD</a>.</p>
</div></div></div><div class="blog-entry"><div class="date-comments"><div class="date">Jun 13</div></div><div class="blog-content"><h2><a href="/blog/2011-06-13-agorian-survival-new-employee-edition.html">Agorian Survival: New employee edition</a></h2><div class="blog-author">By <strong>An Intern</strong></div><div class="blog-body"><p>Around this time last year, I was preparing to return to my internship with a fortune 50 company. However, the excitement that normally comes with such an accomplishment escaped me. The reason is because I knew exactly what to expect. I’d dress up in typical business attire and sit at my desk from 9-5, while waiting for the occasional computer crash or random fire drill. With so much to look forward to, who could complain, right?</p>

<p>Wrong. When my last day came, I decided that I had officially retired the repetition, stress and boredom. After putting my best foot forward, I landed a job at Agora Games and things were completely different. I seemed to have entered an unfamiliar world, full of fun and exciting individuals with no limit to their creative potential. The plethora of randomness and the nature of our work, combined with the flexibility and surreal environment, formulated a culture that removed the work out of the job.</p>

<p>On your first day at Agora, you will be set up at a new computer with a standard four-legged chair. I mention the chair’s regularity because it is then your prerogative to choose a new one from Staples. Your first course of action however, is to tour around the office for a company-wide meet and greet. Of course, no one expects that you’ll remember their name. Down the line, people will generally re-introduce themselves and try to get to know the family’s new addition.</p>

<p>Like many, I place high value on self-expression. With that, I can proudly say that one of the biggest perks you’ll find at Agora is freedom.  This isn’t a bureaucratic work environment where you’ll get sanctioned for forgetting to tuck in your shirt.  Whether you want to dress like Prince or the old school New York Knicks players is up to you.</p>

<p>Expect to find the necessary hierarchies and team divisions, which keep us organized and successful but you won’t be able to tell who’s who. Just yesterday a few of us went for ice cream with the CEO. We’re well structured which leads us to power projects like Guitar Hero, Call of Duty, or Mortal Kombat but at the same time, perfectly balanced to produce happier, more driven employees.</p>

<p>To conclude this rant, I have a lot to look forward to and a lot to learn, but I also have an array of exciting individuals to learn from.  Additionally, with the constant stream of new challenges that keep me enticed, I couldn’t have chosen a better place to work.</p>

<p> </p>
</div></div></div><div class="blog-entry"><div class="date-comments"><div class="date">Jun 9</div></div><div class="blog-content"><h2><a href="/blog/2011-06-09-the-friendly-point.html">The Friendly Point</a></h2><div class="blog-author">By <strong>Blake Taylor</strong></div><div class="blog-body"><p>Do you use points or do you use pixels? I've fallen in love with points. If you know me, you might already know this because I talk about them all the time. So what is it that I like about points, or perhaps, what is it that I dislike about pixels?</p>

<p>First off, did you know that a pixel isn't actually a pixel? As it turns out, what we refer to as a pixel nowadays, is more accurately defined as a device independent pixel, also known as a kludge. Consider this, you’re a developer, 10 years back, listening to bootylicious while styling with your bowl haircut. You’re probably specifying things in pixels with the assumption that monitors will never have more than the cutting edge 96ppi. Now fast-forward to present day with our 400 some odd pixel iPhone displays and consider how compressed that same page looks. Displays may be increasing in resolution, but our eyes aren’t. Additionally, we can't let our pixel-based designs shrink as resolution increases, so we what do we do? We redefine the pixel to the critical measure of 1/96 of an inch.</p>

<p>Interestingly enough, this measure does have magical properties of it's own. However, it’s a system that seems to be rooted in happenstance, so I feel a little dirty about using it without considering anything more. The point system, on the other hand, not only doesn't suffer from this shameful introduction, but hell, there's elegance in its history.</p>

<p>The point (pt) goes way back and has a helpful cousin, the pica, with its own special abilities. So why do you think those crazy typesetters and print practitioners choose the point and the pica even to this day? I would certainly propose flexibility as the reason. 1 pixel is equivalent to 1/96 of an inch, what the hell does that mean? Now, consider 1/72 of an inch and we're getting into the territory where I might actually recognize the difference of a single unit. We're all familiar with 12pt font, there's also 11, 10, 9, and 8. It’s simple enough, pick a font above 7 and you’ll be able to read it. What about 32pt? That's headline font in the print world. Guess what, there's no reason why it can't be used in the web world as well. It's just that we realize we're moving bits around and not ink, so we use relative measures such as the em for fonts, but it should all still be rooted in the friendly point.</p>

<p>So what's a pica? Well a pica is 1/6 of an inch. 6, huh, well that's a nice number. Half of that is 3. I like 3. Get this, if there's 6 pica in an inch and there's 72 points in an inch, then that means there's 12 points in pica. 12, now that's an awesome number. It's evenly divisible by 2, 3, and 4. How many numbers can you say that about? I'm sure the answer is infinite, but now you’re just being a jerk and you’re missing my point. 12 is cool, 6 is cool, 3 is cool, 1.5 is cool, .75 is cool even .375 is manageable. Let's go the other way. 24 = 2pc, 48 = 4pc, 96 = 8pc. There's that damn number again.</p>

<p>Anyway, what's my point? (No pun intended) Use points. They're there and they're not fugly. Converting pixels into points is easy, just multiply by .75. Also, since it’s rooted in what's made print look good for years rather then what the state of the art was when CSS became popular, the numbers just tend to work out nicer. Give em a try (haha, another pun); what do you have to lose?</p>
</div></div></div><div class="blog-entry"><div class="date-comments"><div class="date">Jun 7</div></div><div class="blog-content"><h2><a href="/blog/2011-06-07-did-you-miss-mlg-columbus.html">Did you miss MLG Columbus?</a></h2><div class="blog-author">By <strong>Brian Corrigan</strong></div><div class="blog-body"><p>This weekend, MLG held a highly competitive, highly anticipated competition to test the strengths of pro gamers alike. The Pro Circuit, this time in Columbus, Ohio, included a number of competitors facing off for champion status in StarCraft 2, Halo: Reach and Call of Duty: Black Ops.  The three-day event concluded as follows:</p>

<p><strong>StarCraft 2</strong></p>

<p>SlayerSMMA, the “Terran” prodigy, defeated second place winner IMLosira in the finals with a four to one win. MMA didn’t lose a single series all weekend and only dropped two games in total. Entering game four with a two-to-one lead, MMA survived massive Roach/Baneling attacks and executed excellent drop plays to shut Losira down. In game five, MMA deployed early reapers to kill off Losira’s drones. He eventually followed up with a big Marine/Tank force to force the surrender.</p>

<p><strong>Halo:</strong> Reach</p>

<p>Dropping just one map, team Instinct, consisting of Ogre 2, Roy, Lunchbox and Pistola, were crowned MLG Columbus Halo champions. Instinct left with an amazing record of 21:1 after having defeated second place winner Str8 Rippin. It wasn’t until facing third place winners Dynasty in the WB final that they dropped a game. That however didn’t faze the team as they continued on to win the match and dominate the tournament.</p>

<p><strong>Call of Duty:</strong> Black Ops</p>

<p>MLG Columbus produced a surprising sequence of events during the Call of Duty match ups. As day three continued, some of the highly favored teams fell into the losers bracket and the finals ended in an unexpected sweep. Optic Gaming was the victor who claimed the Black Ops Pro Circuit trophy.  Force, who was originally twelfth seeded, earned second place after losing six to none.</p>

<p>Overall, the event continues to open doors for young teams like Fly Society who placed ninth, but managed to make a name for themselves. Congratulations to all of the winners and shout out to everyone who helped make this possible. The next event is in July at Anaheim, CA; can you afford to miss greatness in the making? http:www.majorleaguegaming.com</p>
</div></div></div><div class="blog-entry"><div class="date-comments"><div class="date">Jun 6</div></div><div class="blog-content"><h2><a href="/blog/2011-06-06-cucumber-and-behavior-driven-infrastructure-validation.html">Cucumber and Behavior Driven Infrastructure Validation</a></h2><div class="blog-author">By <strong>David Czarnecki</strong></div><div class="blog-body"><p>Did you ever think to use Cucumber to write scenarios to validate your infrastructure? Here's a short guide to help you get started.</p>

<p>I'm going to keep this intentionally short because I don't want to steal the thunder away from our systems team, but I did get a fair number of pings inquiring about this after tweeting about it, so it's worth getting the word out.</p>

<p><strong>Start a new infrastructure validation project</strong></p>

<p>Your Gemfile should reference the gems for rake and cucumber at a minimum. The Rakefile can be the minimal Cucumber-ified to get started.</p>

<p>{% gist 1011361 %}</p>

<p><strong>Write your Cucumber features and scenarios for the parts of the infrastructure you want to validate</strong></p>

<p>Examples of this may be "aliveness" of servers by pinging them or making sure processes are running. For example, with MySQL:</p>

<p>{% gist 1011369 %}</p>

<p>You'll need to back those scenario step definitions up with the appropriate code. I'm going to leave that out of this post for now.</p>

<p><strong>Tag your scenarios appropriately</strong></p>

<p>You should tag your scenarios in the manner that makes sense for your organization and in the way that you'll be running them and responding to them. For example, you may want to run @critical scenarios from cron every 5 minutes (or some appropriate interval) and make sure that if these fail, someone gets more than an e-mail. You may want to run @rise_and_shine scenarios at 6 AM after other system tasks have run, for example, to validate log rotation.</p>

<p><strong>KISS me baby</strong></p>

<p>Keep It Simple Stupid. If you just want to use this for sanity checks, that's cool. You might not need to go full scale <a href="http://www.nagios.org/">Nagios</a> and <a href="http://auxesis.github.com/cucumber-nagios/">cucumber-nagios</a> right away. Integrate this into your existing infrastructure and monitoring processes in the way that it makes the most sense.</p>

<p>Hopefully this has been helpful to you. I'll keep pushing the systems team here to get the bloggity blog blog posts about this coming. If you want to follow those guys, be sure to follow <a href="http://twitter.com/ironwallaby">@ironwallaby</a>, <a href="http://twitter.com/dahui0401">@dahui0401</a> and <a href="http://twitter.com/gwaldo">@gwaldo</a>.</p>

<p>You can find more hilarity over on my Twitter account, <a href="http://twitter.com/czarneckid">@CzarneckiD</a>.</p>
</div></div></div></section><aside id="sidebar"><div class="block" id="block-archive"><h2>Blog archives</h2><h3>2013</h3><ul><li><a href="/blog/2013/11.html">November 2013</a></li><li><a href="/blog/2013/10.html">October 2013</a></li><li><a href="/blog/2013/09.html">September 2013</a></li><li><a href="/blog/2013/08.html">August 2013</a></li><li><a href="/blog/2013/07.html">July 2013</a></li><li><a href="/blog/2013/06.html">June 2013</a></li><li><a href="/blog/2013/05.html">May 2013</a></li><li><a href="/blog/2013/04.html">April 2013</a></li><li><a href="/blog/2013/03.html">March 2013</a></li><li><a href="/blog/2013/02.html">February 2013</a></li><li><a href="/blog/2013/01.html">January 2013</a></li></ul><h3>2012</h3><ul><li><a href="/blog/2012/12.html">December 2012</a></li><li><a href="/blog/2012/11.html">November 2012</a></li><li><a href="/blog/2012/10.html">October 2012</a></li><li><a href="/blog/2012/09.html">September 2012</a></li><li><a href="/blog/2012/08.html">August 2012</a></li><li><a href="/blog/2012/07.html">July 2012</a></li><li><a href="/blog/2012/06.html">June 2012</a></li><li><a href="/blog/2012/05.html">May 2012</a></li><li><a href="/blog/2012/04.html">April 2012</a></li><li><a href="/blog/2012/03.html">March 2012</a></li><li><a href="/blog/2012/02.html">February 2012</a></li><li><a href="/blog/2012/01.html">January 2012</a></li></ul><h3>2011</h3><ul><li><a href="/blog/2011/10.html">October 2011</a></li><li><a href="/blog/2011/09.html">September 2011</a></li><li><a href="/blog/2011/08.html">August 2011</a></li><li><a href="/blog/2011/07.html">July 2011</a></li><li><a href="/blog/2011/06.html">June 2011</a></li><li><a href="/blog/2011/05.html">May 2011</a></li><li><a href="/blog/2011/04.html">April 2011</a></li><li><a href="/blog/2011/03.html">March 2011</a></li><li><a href="/blog/2011/02.html">February 2011</a></li><li><a href="/blog/2011/01.html">January 2011</a></li></ul><h3>2010</h3><ul><li><a href="/blog/2010/12.html">December 2010</a></li><li><a href="/blog/2010/11.html">November 2010</a></li><li><a href="/blog/2010/10.html">October 2010</a></li><li><a href="/blog/2010/09.html">September 2010</a></li><li><a href="/blog/2010/08.html">August 2010</a></li><li><a href="/blog/2010/07.html">July 2010</a></li><li><a href="/blog/2010/06.html">June 2010</a></li><li><a href="/blog/2010/05.html">May 2010</a></li><li><a href="/blog/2010/04.html">April 2010</a></li><li><a href="/blog/2010/03.html">March 2010</a></li><li><a href="/blog/2010/02.html">February 2010</a></li><li><a href="/blog/2010/01.html">January 2010</a></li></ul><h3>2009</h3><ul><li><a href="/blog/2009/12.html">December 2009</a></li><li><a href="/blog/2009/11.html">November 2009</a></li><li><a href="/blog/2009/10.html">October 2009</a></li><li><a href="/blog/2009/09.html">September 2009</a></li><li><a href="/blog/2009/08.html">August 2009</a></li><li><a href="/blog/2009/07.html">July 2009</a></li><li><a href="/blog/2009/06.html">June 2009</a></li><li><a href="/blog/2009/05.html">May 2009</a></li><li><a href="/blog/2009/04.html">April 2009</a></li><li><a href="/blog/2009/03.html">March 2009</a></li><li><a href="/blog/2009/02.html">February 2009</a></li><li><a href="/blog/2009/01.html">January 2009</a></li></ul><h3>2008</h3><ul><li><a href="/blog/2008/11.html">November 2008</a></li><li><a href="/blog/2008/10.html">October 2008</a></li><li><a href="/blog/2008/09.html">September 2008</a></li><li><a href="/blog/2008/08.html">August 2008</a></li></ul></div></aside></article></div></div></div><footer><div class="outer-wrap"><div class="wrap"><div id="copyright"><img alt="Agora Games" src="../../assets/images/agora-logo-agga-7c1d9a1f.png"> <a href="http://majorleaguegaming.com" target="_blank"><img alt="Major League Gaming" src="../../assets/images/mlg-logo-28545055.png"></a><a href="mailto:info@agoragames.com" id="email-us">Email Us</a><p>359 Broadway, Third Floor, Troy, NY 12180</p><p class="dim">&copy; 2013 Agora Games. All Rights Reserved.</p></div></div></div></footer><div class="hide"><iframe id="wufoo-iframe" src="javascript:void(0)"></iframe><a id="wufoo-thanks" href="/thanks.html"></a></div><!--[if lt IE 9]>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
<![endif]-->
<!--[if gte IE 9]><!-->
  <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
<!--<![endif]-->
<script>
  if (!window.jQuery) {
    document.write('<script type="text/javascript" src="../../assets/javascripts/vendor/jquery.min-199fc76d.js"><' + '/script>');
  }
</script>
<script src="../../assets/javascripts/all-7e4f2f03.js" type="text/javascript"></script></body></html>